Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Degree statistics: avg=19.00, min=19, max=19
Model variant: baseline
Model parameters: 6,603,710
Sketchguard Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Config: SketchguardConfig(gamma=2, kappa=1, alpha=0.5, min_neighbors=1, sketch_size=1000, network_seed=987654321, attack_detection_window=5)
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0168 ± 0.0139
Round 001: test acc mean=0.5233 ± 0.0311 | min=0.4669 max=0.5932
         : test loss mean=3.7209 ± 0.0278
         : individual accs = ['0.566376', '0.522246', '0.562362', '0.528271', '0.530677', '0.593189', '0.522061', '0.511612', '0.525889', '0.468787', '0.545740', '0.527784', '0.466895', '0.475816', '0.539240', '0.540333', '0.492656', '0.528568', '0.511508', '0.506541']
         : correct/total = [(2338, 4128), (2195, 4203), (2295, 4081), (2289, 4333), (2171, 4091), (2543, 4287), (2189, 4193), (2225, 4349), (2204, 4191), (2005, 4277), (2261, 4143), (2213, 4193), (1911, 4093), (1997, 4197), (2185, 4052), (2177, 4029), (2046, 4153), (2211, 4183), (2089, 4084), (2091, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 002: test acc mean=0.6878 ± 0.0149 | min=0.6587 max=0.7166
         : test loss mean=3.4468 ± 0.0275
         : individual accs = ['0.697917', '0.690221', '0.684881', '0.697900', '0.699096', '0.716585', '0.662056', '0.690274', '0.685755', '0.667758', '0.708182', '0.682566', '0.678964', '0.687634', '0.690770', '0.658724', '0.678546', '0.713364', '0.686582', '0.677810']
         : correct/total = [(2881, 4128), (2901, 4203), (2795, 4081), (3024, 4333), (2860, 4091), (3072, 4287), (2776, 4193), (3002, 4349), (2874, 4191), (2856, 4277), (2934, 4143), (2862, 4193), (2779, 4093), (2886, 4197), (2799, 4052), (2654, 4029), (2818, 4153), (2984, 4183), (2804, 4084), (2798, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 003: test acc mean=0.7106 ± 0.0226 | min=0.6373 max=0.7379
         : test loss mean=3.1991 ± 0.0379
         : individual accs = ['0.722384', '0.698787', '0.706199', '0.718671', '0.725739', '0.710987', '0.703792', '0.737871', '0.716535', '0.736498', '0.733526', '0.675650', '0.724896', '0.709793', '0.714709', '0.704890', '0.690104', '0.637342', '0.726738', '0.717781']
         : correct/total = [(2982, 4128), (2937, 4203), (2882, 4081), (3114, 4333), (2969, 4091), (3048, 4287), (2951, 4193), (3209, 4349), (3003, 4191), (3150, 4277), (3039, 4143), (2833, 4193), (2967, 4093), (2979, 4197), (2896, 4052), (2840, 4029), (2866, 4153), (2666, 4183), (2968, 4084), (2963, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 004: test acc mean=0.6969 ± 0.0205 | min=0.6589 max=0.7383
         : test loss mean=2.8141 ± 0.0454
         : individual accs = ['0.704215', '0.738282', '0.685126', '0.689592', '0.713517', '0.683695', '0.701884', '0.716487', '0.711286', '0.681319', '0.675839', '0.703792', '0.660640', '0.693591', '0.705824', '0.689501', '0.732483', '0.681090', '0.711557', '0.658915']
         : correct/total = [(2907, 4128), (3103, 4203), (2796, 4081), (2988, 4333), (2919, 4091), (2931, 4287), (2943, 4193), (3116, 4349), (2981, 4191), (2914, 4277), (2800, 4143), (2951, 4193), (2704, 4093), (2911, 4197), (2860, 4052), (2778, 4029), (3042, 4153), (2849, 4183), (2906, 4084), (2720, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 005: test acc mean=0.6482 ± 0.0268 | min=0.6033 max=0.7066
         : test loss mean=2.2504 ± 0.0703
         : individual accs = ['0.653585', '0.659767', '0.604509', '0.603277', '0.677585', '0.647539', '0.653470', '0.706599', '0.648533', '0.678045', '0.632151', '0.644884', '0.615930', '0.655468', '0.651283', '0.612063', '0.655911', '0.646665', '0.690500', '0.625242']
         : correct/total = [(2698, 4128), (2773, 4203), (2467, 4081), (2614, 4333), (2772, 4091), (2776, 4287), (2740, 4193), (3073, 4349), (2718, 4191), (2900, 4277), (2619, 4143), (2704, 4193), (2521, 4093), (2751, 4197), (2639, 4052), (2466, 4029), (2724, 4153), (2705, 4183), (2820, 4084), (2581, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 006: test acc mean=0.6788 ± 0.0263 | min=0.6213 max=0.7253
         : test loss mean=1.5511 ± 0.0648
         : individual accs = ['0.673934', '0.702831', '0.645920', '0.621279', '0.711073', '0.688827', '0.708562', '0.678547', '0.671916', '0.654664', '0.668115', '0.714286', '0.640850', '0.663807', '0.725321', '0.663688', '0.692271', '0.675831', '0.701028', '0.673450']
         : correct/total = [(2782, 4128), (2954, 4203), (2636, 4081), (2692, 4333), (2909, 4091), (2953, 4287), (2971, 4193), (2951, 4349), (2816, 4191), (2800, 4277), (2768, 4143), (2995, 4193), (2623, 4093), (2786, 4197), (2939, 4052), (2674, 4029), (2875, 4153), (2827, 4183), (2863, 4084), (2780, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 007: test acc mean=0.7736 ± 0.0144 | min=0.7491 max=0.7964
         : test loss mean=0.9009 ± 0.0453
         : individual accs = ['0.779797', '0.779681', '0.752267', '0.750981', '0.796382', '0.780499', '0.770332', '0.786848', '0.770699', '0.776479', '0.749216', '0.772001', '0.781090', '0.796283', '0.780109', '0.749069', '0.783048', '0.760698', '0.789177', '0.768169']
         : correct/total = [(3219, 4128), (3277, 4203), (3070, 4081), (3254, 4333), (3258, 4091), (3346, 4287), (3230, 4193), (3422, 4349), (3230, 4191), (3321, 4277), (3104, 4143), (3237, 4193), (3197, 4093), (3342, 4197), (3161, 4052), (3018, 4029), (3252, 4153), (3182, 4183), (3223, 4084), (3171, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 008: test acc mean=0.8173 ± 0.0073 | min=0.8027 max=0.8315
         : test loss mean=0.6010 ± 0.0243
         : individual accs = ['0.816376', '0.826790', '0.821612', '0.813986', '0.820582', '0.817821', '0.813976', '0.831456', '0.818182', '0.827449', '0.808593', '0.816838', '0.821891', '0.818203', '0.805775', '0.802681', '0.816759', '0.811140', '0.826396', '0.809835']
         : correct/total = [(3370, 4128), (3475, 4203), (3353, 4081), (3527, 4333), (3357, 4091), (3506, 4287), (3413, 4193), (3616, 4349), (3429, 4191), (3539, 4277), (3350, 4143), (3425, 4193), (3364, 4093), (3434, 4197), (3265, 4052), (3234, 4029), (3392, 4153), (3393, 4183), (3375, 4084), (3343, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 009: test acc mean=0.8307 ± 0.0071 | min=0.8215 max=0.8450
         : test loss mean=0.5260 ± 0.0212
         : individual accs = ['0.824855', '0.836545', '0.841705', '0.830833', '0.839648', '0.833683', '0.823992', '0.845022', '0.827249', '0.839140', '0.823799', '0.824231', '0.833130', '0.829164', '0.823050', '0.821544', '0.835781', '0.823572', '0.833986', '0.823159']
         : correct/total = [(3405, 4128), (3516, 4203), (3435, 4081), (3600, 4333), (3435, 4091), (3574, 4287), (3455, 4193), (3675, 4349), (3467, 4191), (3589, 4277), (3413, 4143), (3456, 4193), (3410, 4093), (3480, 4197), (3335, 4052), (3310, 4029), (3471, 4153), (3445, 4183), (3406, 4084), (3398, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...
Round 010: test acc mean=0.8387 ± 0.0070 | min=0.8241 max=0.8482
         : test loss mean=0.4946 ± 0.0212
         : individual accs = ['0.839632', '0.842018', '0.841951', '0.838680', '0.848203', '0.839282', '0.835202', '0.847781', '0.835600', '0.846621', '0.832971', '0.825900', '0.843147', '0.843698', '0.830948', '0.831224', '0.846617', '0.835047', '0.845739', '0.824128']
         : correct/total = [(3466, 4128), (3539, 4203), (3436, 4081), (3634, 4333), (3470, 4091), (3598, 4287), (3502, 4193), (3687, 4349), (3502, 4191), (3621, 4277), (3451, 4143), (3463, 4193), (3451, 4093), (3541, 4197), (3367, 4052), (3349, 4029), (3516, 4153), (3493, 4183), (3454, 4084), (3402, 4128)]
         : sketchguard stats = ['Node 0: acc_rate=1.000', 'Node 1: acc_rate=1.000', 'Node 2: acc_rate=1.000']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: sketchguard
Overall test accuracy: mean=0.8387 ± 0.0070

=== Sketchguard SUMMARY ===
Node 0: acceptance=1.000
Node 1: acceptance=1.000
Node 2: acceptance=1.000
Node 3: acceptance=1.000
Node 4: acceptance=1.000
Node 5: acceptance=1.000
Node 6: acceptance=1.000
Node 7: acceptance=1.000
Node 8: acceptance=1.000
Node 9: acceptance=1.000
Node 10: acceptance=1.000
Node 11: acceptance=1.000
Node 12: acceptance=1.000
Node 13: acceptance=1.000
Node 14: acceptance=1.000
Node 15: acceptance=1.000
Node 16: acceptance=1.000
Node 17: acceptance=1.000
Node 18: acceptance=1.000
Node 19: acceptance=1.000

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Sketch transfer: 0.000s (0.0%)
    - Model fetch (accepted): 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Sketching: 6.897s (99.5%)
    - Filtering: 0.002s (0.0%)
    - Aggregation: 0.035s (0.5%)
  TOTALS:
    - Total computation: 6.933s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 6.933s

=== PER-NODE AVERAGE TIME ===
  - Sketching: 6.675s
  - Filtering: 0.001s
  - Aggregation: 0.028s
  - Sketch transfer: 0.000s
  - Model fetch: 0.000s
  - Total per node: 6.705s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total sketching: 133.499s
  - Total filtering: 0.027s
  - Total aggregation: 0.564s
  - Total sketch transfer: 0.000s
  - Total model fetch: 0.000s
  - Grand total: 134.090s
  - Mean acceptance rate: 1.000

Sketchguard Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

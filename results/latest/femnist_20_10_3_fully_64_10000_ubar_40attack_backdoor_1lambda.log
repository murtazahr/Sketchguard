Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Degree statistics: avg=19.00, min=19, max=19
Attack: Compromised 8/20 nodes: [1, 5, 11, 12, 13, 14, 17, 18]
Attack type: backdoor, lambda: 1.0
Backdoor target label: 0, trigger size: 4
Model variant: baseline
Model parameters: 6,603,710
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.6
  - Stage 1: Distance-based filtering (select 60% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0168 ± 0.0139
Backdoor attack: Created poisoned datasets for 8 compromised nodes
Round 001: test acc mean=0.3157 ± 0.1773 | min=0.0488 max=0.5489
         : test loss mean=6963.2992 ± 8791.8691
         : individual accs = ['0.516231', '0.048775', '0.548885', '0.392569', '0.426791', '0.214136', '0.405676', '0.520579', '0.515867', '0.343465', '0.429882', '0.107322', '0.054239', '0.049083', '0.150296', '0.451229', '0.444016', '0.155630', '0.103330', '0.435078']
         : correct/total = [(2131, 4128), (205, 4203), (2240, 4081), (1701, 4333), (1746, 4091), (918, 4287), (1701, 4193), (2264, 4349), (2162, 4191), (1469, 4277), (1781, 4143), (450, 4193), (222, 4093), (206, 4197), (609, 4052), (1818, 4029), (1844, 4153), (651, 4183), (422, 4084), (1796, 4128)]
         : compromised: 0.1104, honest: 0.4525
         : ubar stats = ['Node 0: s1=0.579, s2=0.364', 'Node 1: s1=0.579, s2=1.000', 'Node 2: s1=0.579, s2=0.545']...
Round 002: test acc mean=0.4156 ± 0.3050 | min=0.0048 max=0.7103
         : test loss mean=2286.7239 ± 5085.5018
         : individual accs = ['0.710271', '0.046158', '0.670179', '0.602816', '0.648252', '0.048519', '0.655855', '0.674638', '0.648771', '0.671031', '0.707700', '0.045314', '0.047887', '0.055278', '0.049605', '0.696203', '0.646280', '0.004781', '0.048482', '0.633721']
         : correct/total = [(2932, 4128), (194, 4203), (2735, 4081), (2612, 4333), (2652, 4091), (208, 4287), (2750, 4193), (2934, 4349), (2719, 4191), (2870, 4277), (2932, 4143), (190, 4193), (196, 4093), (232, 4197), (201, 4052), (2805, 4029), (2684, 4153), (20, 4183), (198, 4084), (2616, 4128)]
         : compromised: 0.0433, honest: 0.6638
         : ubar stats = ['Node 0: s1=0.579, s2=0.682', 'Node 1: s1=0.579, s2=1.000', 'Node 2: s1=0.579, s2=0.545']...
Round 003: test acc mean=0.4419 ± 0.3215 | min=0.0488 max=0.7650
         : test loss mean=nan ± nan
         : individual accs = ['0.765019', '0.048775', '0.581475', '0.697900', '0.743583', '0.050618', '0.694014', '0.679467', '0.688141', '0.659341', '0.749940', '0.049606', '0.054239', '0.049083', '0.051826', '0.747084', '0.708163', '0.049486', '0.052889', '0.717781']
         : correct/total = [(3158, 4128), (205, 4203), (2373, 4081), (3024, 4333), (3042, 4091), (217, 4287), (2910, 4193), (2955, 4349), (2884, 4191), (2820, 4277), (3107, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3010, 4029), (2941, 4153), (207, 4183), (216, 4084), (2963, 4128)]
         : compromised: 0.0508, honest: 0.7027
         : ubar stats = ['Node 0: s1=0.579, s2=0.636', 'Node 1: s1=0.579, s2=0.697', 'Node 2: s1=0.579, s2=0.394']...
Round 004: test acc mean=0.4614 ± 0.3370 | min=0.0453 max=0.7791
         : test loss mean=nan ± nan
         : individual accs = ['0.708333', '0.048775', '0.642735', '0.772444', '0.748472', '0.045253', '0.726449', '0.733732', '0.712241', '0.723638', '0.776732', '0.049606', '0.054239', '0.049083', '0.051826', '0.779102', '0.766434', '0.049486', '0.052889', '0.735950']
         : correct/total = [(2924, 4128), (205, 4203), (2623, 4081), (3347, 4333), (3062, 4091), (194, 4287), (3046, 4193), (3191, 4349), (2985, 4191), (3095, 4277), (3218, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3139, 4029), (3183, 4153), (207, 4183), (216, 4084), (3038, 4128)]
         : compromised: 0.0501, honest: 0.7355
         : ubar stats = ['Node 0: s1=0.579, s2=0.500', 'Node 1: s1=0.579, s2=0.545', 'Node 2: s1=0.579, s2=0.409']...
Round 005: test acc mean=0.4934 ± 0.3621 | min=0.0453 max=0.8092
         : test loss mean=nan ± nan
         : individual accs = ['0.808624', '0.048775', '0.747611', '0.792523', '0.791982', '0.045253', '0.789411', '0.791446', '0.772847', '0.809212', '0.795317', '0.049606', '0.054239', '0.049083', '0.051826', '0.778853', '0.806887', '0.049486', '0.052889', '0.781492']
         : correct/total = [(3338, 4128), (205, 4203), (3051, 4081), (3434, 4333), (3240, 4091), (194, 4287), (3310, 4193), (3442, 4349), (3239, 4191), (3461, 4277), (3295, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3138, 4029), (3351, 4153), (207, 4183), (216, 4084), (3226, 4128)]
         : compromised: 0.0501, honest: 0.7889
         : ubar stats = ['Node 0: s1=0.579, s2=0.418', 'Node 1: s1=0.579, s2=0.455', 'Node 2: s1=0.579, s2=0.491']...
Round 006: test acc mean=0.5075 ± 0.3735 | min=0.0453 max=0.8235
         : test loss mean=nan ± nan
         : individual accs = ['0.816376', '0.048775', '0.812791', '0.813293', '0.823515', '0.045253', '0.809921', '0.819269', '0.808399', '0.817162', '0.811731', '0.049606', '0.054239', '0.049083', '0.051826', '0.801191', '0.817963', '0.049486', '0.052889', '0.796996']
         : correct/total = [(3370, 4128), (205, 4203), (3317, 4081), (3524, 4333), (3369, 4091), (194, 4287), (3396, 4193), (3563, 4349), (3388, 4191), (3495, 4277), (3363, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3228, 4029), (3397, 4153), (207, 4183), (216, 4084), (3290, 4128)]
         : compromised: 0.0501, honest: 0.8124
         : ubar stats = ['Node 0: s1=0.579, s2=0.424', 'Node 1: s1=0.579, s2=0.394', 'Node 2: s1=0.579, s2=0.455']...
Round 007: test acc mean=0.5156 ± 0.3801 | min=0.0453 max=0.8345
         : test loss mean=nan ± nan
         : individual accs = ['0.830426', '0.048775', '0.820632', '0.826679', '0.834026', '0.045253', '0.825662', '0.830076', '0.821284', '0.834463', '0.815593', '0.049606', '0.054239', '0.049083', '0.051826', '0.818069', '0.831688', '0.049486', '0.052889', '0.821948']
         : correct/total = [(3428, 4128), (205, 4203), (3349, 4081), (3582, 4333), (3412, 4091), (194, 4287), (3462, 4193), (3610, 4349), (3442, 4191), (3569, 4277), (3379, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3296, 4029), (3454, 4153), (207, 4183), (216, 4084), (3393, 4128)]
         : compromised: 0.0501, honest: 0.8259
         : ubar stats = ['Node 0: s1=0.579, s2=0.442', 'Node 1: s1=0.579, s2=0.351', 'Node 2: s1=0.579, s2=0.403']...
Round 008: test acc mean=0.5204 ± 0.3840 | min=0.0453 max=0.8459
         : test loss mean=nan ± nan
         : individual accs = ['0.836725', '0.048775', '0.838765', '0.837757', '0.841604', '0.045253', '0.825662', '0.845942', '0.832975', '0.838438', '0.819937', '0.049606', '0.054239', '0.049083', '0.051826', '0.824770', '0.836263', '0.049486', '0.052889', '0.828488']
         : correct/total = [(3454, 4128), (205, 4203), (3423, 4081), (3630, 4333), (3443, 4091), (194, 4287), (3462, 4193), (3679, 4349), (3491, 4191), (3586, 4277), (3397, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3323, 4029), (3473, 4153), (207, 4183), (216, 4084), (3420, 4128)]
         : compromised: 0.0501, honest: 0.8339
         : ubar stats = ['Node 0: s1=0.579, s2=0.420', 'Node 1: s1=0.579, s2=0.318', 'Node 2: s1=0.579, s2=0.364']...
Round 009: test acc mean=0.5227 ± 0.3859 | min=0.0453 max=0.8498
         : test loss mean=nan ± nan
         : individual accs = ['0.825339', '0.048775', '0.849792', '0.837295', '0.848692', '0.045253', '0.836632', '0.841343', '0.834646', '0.843348', '0.830558', '0.049606', '0.054239', '0.049083', '0.051826', '0.827997', '0.848543', '0.049486', '0.052889', '0.828488']
         : correct/total = [(3407, 4128), (205, 4203), (3468, 4081), (3628, 4333), (3472, 4091), (194, 4287), (3508, 4193), (3659, 4349), (3498, 4191), (3607, 4277), (3441, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3336, 4029), (3524, 4153), (207, 4183), (216, 4084), (3420, 4128)]
         : compromised: 0.0501, honest: 0.8377
         : ubar stats = ['Node 0: s1=0.579, s2=0.384', 'Node 1: s1=0.579, s2=0.293', 'Node 2: s1=0.579, s2=0.333']...
Round 010: test acc mean=0.5267 ± 0.3892 | min=0.0453 max=0.8537
         : test loss mean=nan ± nan
         : individual accs = ['0.846899', '0.048775', '0.853712', '0.852296', '0.847470', '0.045253', '0.841641', '0.853070', '0.837748', '0.853636', '0.836350', '0.049606', '0.054239', '0.049083', '0.051826', '0.828493', '0.845895', '0.049486', '0.052889', '0.835514']
         : correct/total = [(3496, 4128), (205, 4203), (3484, 4081), (3693, 4333), (3467, 4091), (194, 4287), (3529, 4193), (3710, 4349), (3511, 4191), (3651, 4277), (3465, 4143), (208, 4193), (222, 4093), (206, 4197), (210, 4052), (3338, 4029), (3513, 4153), (207, 4183), (216, 4084), (3449, 4128)]
         : compromised: 0.0501, honest: 0.8444
         : ubar stats = ['Node 0: s1=0.579, s2=0.364', 'Node 1: s1=0.579, s2=0.273', 'Node 2: s1=0.579, s2=0.327']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: ubar
Attack: backdoor, 40.0% compromised
Final accuracy - Compromised: 0.0501, Honest: 0.8444
Overall test accuracy: mean=0.5267 ± 0.3892

=== BACKDOOR ATTACK SUCCESS RATE (ASR) ===
Target label: 0
Trigger size: 4x4
Overall ASR: 0.4312 ± 0.4645
Honest nodes ASR: 0.0519 ± 0.0044
Compromised nodes ASR: 1.0000 ± 0.0000
Note: Higher ASR indicates more successful backdoor attack

=== UBAR SUMMARY ===
Node 0: stage1=0.579, stage2=0.364, overall=0.211
Node 1: stage1=0.579, stage2=0.273, overall=0.158
Node 2: stage1=0.579, stage2=0.327, overall=0.189
Node 3: stage1=0.579, stage2=0.173, overall=0.100
Node 4: stage1=0.579, stage2=0.245, overall=0.142
Node 5: stage1=0.579, stage2=0.255, overall=0.147
Node 6: stage1=0.579, stage2=0.382, overall=0.221
Node 7: stage1=0.579, stage2=0.400, overall=0.232
Node 8: stage1=0.579, stage2=0.436, overall=0.253
Node 9: stage1=0.579, stage2=0.327, overall=0.189
Node 10: stage1=0.579, stage2=0.300, overall=0.174
Node 11: stage1=0.579, stage2=0.273, overall=0.158
Node 12: stage1=0.579, stage2=0.273, overall=0.158
Node 13: stage1=0.579, stage2=0.273, overall=0.158
Node 14: stage1=0.579, stage2=0.273, overall=0.158
Node 15: stage1=0.579, stage2=0.255, overall=0.147
Node 16: stage1=0.579, stage2=0.245, overall=0.142
Node 17: stage1=0.579, stage2=0.273, overall=0.158
Node 18: stage1=0.579, stage2=0.273, overall=0.158
Node 19: stage1=0.579, stage2=0.264, overall=0.153

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Full model transfer: 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Distance computation: 0.160s (3.7%)
    - Loss computation: 4.123s (96.0%)
    - Aggregation: 0.011s (0.3%)
  TOTALS:
    - Total computation: 4.294s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 4.294s

=== PER-NODE AVERAGE TIME ===
  - Distance computation: 0.157s
  - Loss computation: 3.887s
  - Aggregation: 0.007s
  - Model transfer: 0.000s
  - Total per node: 4.051s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total distance computation: 3.137s
  - Total loss computation: 77.747s
  - Total aggregation: 0.132s
  - Total model transfer: 0.000s
  - Grand total: 81.017s
  - Mean Stage 1 acceptance rate: 0.579
  - Mean Stage 2 acceptance rate: 0.294
  - Overall acceptance rate: 0.170

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.6
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 60% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Degree statistics: avg=19.00, min=19, max=19
Attack: Compromised 12/20 nodes: [1, 2, 3, 5, 8, 11, 12, 13, 14, 15, 17, 18]
Attack type: directed_deviation, lambda: 1.0
Model variant: baseline
Model parameters: 6,603,710
Sketchguard Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Config: SketchguardConfig(gamma=2, kappa=1, alpha=0.5, min_neighbors=1, sketch_size=1000, network_seed=987654321, attack_detection_window=5)
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0168 ± 0.0139
Round 001: test acc mean=0.5088 ± 0.0351 | min=0.4419 max=0.5904
         : test loss mean=3.7343 ± 0.0296
         : individual accs = ['0.541182', '0.501547', '0.557216', '0.524348', '0.503789', '0.590390', '0.502743', '0.512072', '0.513720', '0.441899', '0.507845', '0.526115', '0.446616', '0.461758', '0.528134', '0.539588', '0.467373', '0.516615', '0.497551', '0.495397']
         : correct/total = [(2234, 4128), (2108, 4203), (2274, 4081), (2272, 4333), (2061, 4091), (2531, 4287), (2108, 4193), (2227, 4349), (2153, 4191), (1890, 4277), (2104, 4143), (2206, 4193), (1828, 4093), (1938, 4197), (2140, 4052), (2174, 4029), (1941, 4153), (2161, 4183), (2032, 4084), (2045, 4128)]
         : compromised: 0.5170, honest: 0.4965
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 002: test acc mean=0.6662 ± 0.0204 | min=0.6160 max=0.7033
         : test loss mean=3.3819 ± 0.0932
         : individual accs = ['0.674176', '0.682846', '0.664053', '0.685668', '0.674652', '0.703289', '0.648939', '0.672568', '0.646147', '0.646715', '0.677770', '0.647508', '0.637185', '0.680963', '0.678184', '0.616034', '0.660246', '0.694239', '0.670666', '0.662064']
         : correct/total = [(2783, 4128), (2870, 4203), (2710, 4081), (2971, 4333), (2760, 4091), (3015, 4287), (2721, 4193), (2925, 4349), (2708, 4191), (2766, 4277), (2808, 4143), (2715, 4193), (2608, 4093), (2858, 4197), (2748, 4052), (2482, 4029), (2742, 4153), (2904, 4183), (2739, 4084), (2733, 4128)]
         : compromised: 0.6672, honest: 0.6646
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 003: test acc mean=0.6603 ± 0.0377 | min=0.5472 max=0.7094
         : test loss mean=2.8534 ± 0.2227
         : individual accs = ['0.689680', '0.694266', '0.604264', '0.676898', '0.709362', '0.658502', '0.683997', '0.700621', '0.650203', '0.671733', '0.666184', '0.597901', '0.645004', '0.654277', '0.678184', '0.664681', '0.654948', '0.547215', '0.669442', '0.688227']
         : correct/total = [(2847, 4128), (2918, 4203), (2466, 4081), (2933, 4333), (2902, 4091), (2823, 4287), (2868, 4193), (3047, 4349), (2725, 4191), (2873, 4277), (2760, 4143), (2507, 4193), (2640, 4093), (2746, 4197), (2748, 4052), (2678, 4029), (2720, 4153), (2289, 4183), (2734, 4084), (2841, 4128)]
         : compromised: 0.6451, honest: 0.6831
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 004: test acc mean=0.6582 ± 0.0346 | min=0.5942 max=0.7162
         : test loss mean=1.9582 ± 0.2339
         : individual accs = ['0.669574', '0.640257', '0.635874', '0.641588', '0.716206', '0.599254', '0.705700', '0.713037', '0.675495', '0.660977', '0.673184', '0.671119', '0.620327', '0.632118', '0.673001', '0.594192', '0.709126', '0.649295', '0.628795', '0.655039']
         : correct/total = [(2764, 4128), (2691, 4203), (2595, 4081), (2780, 4333), (2930, 4091), (2569, 4287), (2959, 4193), (3101, 4349), (2831, 4191), (2827, 4277), (2789, 4143), (2814, 4193), (2539, 4093), (2653, 4197), (2727, 4052), (2394, 4029), (2945, 4153), (2716, 4183), (2568, 4084), (2704, 4128)]
         : compromised: 0.6384, honest: 0.6879
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 005: test acc mean=0.7555 ± 0.0223 | min=0.6870 max=0.7887
         : test loss mean=1.0288 ± 0.1250
         : individual accs = ['0.771802', '0.743279', '0.750796', '0.733210', '0.783916', '0.754840', '0.765323', '0.788687', '0.744691', '0.784195', '0.761767', '0.735035', '0.743953', '0.749821', '0.759625', '0.687019', '0.778955', '0.765718', '0.747062', '0.759932']
         : correct/total = [(3186, 4128), (3124, 4203), (3064, 4081), (3177, 4333), (3207, 4091), (3236, 4287), (3209, 4193), (3430, 4349), (3121, 4191), (3354, 4277), (3156, 4143), (3082, 4193), (3045, 4093), (3147, 4197), (3078, 4052), (2768, 4029), (3235, 4153), (3203, 4183), (3051, 4084), (3137, 4128)]
         : compromised: 0.7429, honest: 0.7743
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 006: test acc mean=0.8103 ± 0.0066 | min=0.7987 max=0.8216
         : test loss mean=0.6332 ± 0.0262
         : individual accs = ['0.809835', '0.818939', '0.821612', '0.810062', '0.816915', '0.814322', '0.808967', '0.820189', '0.800764', '0.816928', '0.804007', '0.804913', '0.807476', '0.803908', '0.809230', '0.798709', '0.815555', '0.805642', '0.814643', '0.803537']
         : correct/total = [(3343, 4128), (3442, 4203), (3353, 4081), (3510, 4333), (3342, 4091), (3491, 4287), (3392, 4193), (3567, 4349), (3356, 4191), (3494, 4277), (3331, 4143), (3375, 4193), (3305, 4093), (3374, 4197), (3279, 4052), (3218, 4029), (3387, 4153), (3370, 4183), (3327, 4084), (3317, 4128)]
         : compromised: 0.8092, honest: 0.8120
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 007: test acc mean=0.8281 ± 0.0080 | min=0.8124 max=0.8411
         : test loss mean=0.5377 ± 0.0247
         : individual accs = ['0.829215', '0.832025', '0.837295', '0.828064', '0.840870', '0.829018', '0.825662', '0.841113', '0.823431', '0.835399', '0.816558', '0.818269', '0.834596', '0.830832', '0.823544', '0.812360', '0.832410', '0.817356', '0.832762', '0.821221']
         : correct/total = [(3423, 4128), (3497, 4203), (3417, 4081), (3588, 4333), (3440, 4091), (3554, 4287), (3462, 4193), (3658, 4349), (3451, 4191), (3573, 4277), (3383, 4143), (3431, 4193), (3416, 4093), (3487, 4197), (3337, 4052), (3273, 4029), (3457, 4153), (3419, 4183), (3401, 4084), (3390, 4128)]
         : compromised: 0.8266, honest: 0.8303
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 008: test acc mean=0.8380 ± 0.0074 | min=0.8245 max=0.8492
         : test loss mean=0.4982 ± 0.0237
         : individual accs = ['0.836725', '0.843921', '0.845871', '0.842372', '0.849181', '0.841381', '0.830909', '0.847321', '0.835361', '0.847791', '0.824523', '0.829955', '0.843880', '0.837026', '0.830207', '0.826508', '0.843005', '0.831700', '0.842067', '0.830426']
         : correct/total = [(3454, 4128), (3547, 4203), (3452, 4081), (3650, 4333), (3474, 4091), (3607, 4287), (3484, 4193), (3685, 4349), (3501, 4191), (3626, 4277), (3416, 4143), (3480, 4193), (3454, 4093), (3513, 4197), (3364, 4052), (3330, 4029), (3501, 4153), (3479, 4183), (3439, 4084), (3428, 4128)]
         : compromised: 0.8375, honest: 0.8387
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 009: test acc mean=0.8434 ± 0.0074 | min=0.8330 max=0.8581
         : test loss mean=0.4738 ± 0.0209
         : individual accs = ['0.835514', '0.848204', '0.855183', '0.848604', '0.850159', '0.849312', '0.835679', '0.858128', '0.839179', '0.851298', '0.832971', '0.836155', '0.844857', '0.843460', '0.837117', '0.835691', '0.848302', '0.836242', '0.846229', '0.835514']
         : correct/total = [(3449, 4128), (3565, 4203), (3490, 4081), (3677, 4333), (3478, 4091), (3641, 4287), (3504, 4193), (3732, 4349), (3517, 4191), (3641, 4277), (3451, 4143), (3506, 4193), (3458, 4093), (3540, 4197), (3392, 4052), (3367, 4029), (3523, 4153), (3498, 4183), (3456, 4084), (3449, 4128)]
         : compromised: 0.8434, honest: 0.8434
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...
Round 010: test acc mean=0.8476 ± 0.0070 | min=0.8348 max=0.8590
         : test loss mean=0.4594 ± 0.0216
         : individual accs = ['0.846172', '0.856055', '0.853957', '0.849527', '0.858959', '0.850945', '0.840210', '0.856519', '0.844429', '0.852467', '0.841178', '0.837109', '0.851698', '0.851322', '0.842300', '0.838421', '0.852155', '0.841023', '0.853575', '0.834787']
         : correct/total = [(3493, 4128), (3598, 4203), (3485, 4081), (3681, 4333), (3514, 4091), (3648, 4287), (3523, 4193), (3725, 4349), (3539, 4191), (3646, 4277), (3485, 4143), (3510, 4193), (3486, 4093), (3573, 4197), (3413, 4052), (3378, 4029), (3539, 4153), (3518, 4183), (3486, 4084), (3446, 4128)]
         : compromised: 0.8475, honest: 0.8478
         : sketchguard stats = ['Node 0: acc_rate=0.368', 'Node 1: acc_rate=0.421', 'Node 2: acc_rate=0.421']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: sketchguard
Attack: directed_deviation, 60.0% compromised
Final accuracy - Compromised: 0.8475, Honest: 0.8478
Overall test accuracy: mean=0.8476 ± 0.0070

=== Sketchguard SUMMARY ===
Node 0: acceptance=0.368
Node 1: acceptance=0.421
Node 2: acceptance=0.421
Node 3: acceptance=0.421
Node 4: acceptance=0.368
Node 5: acceptance=0.421
Node 6: acceptance=0.368
Node 7: acceptance=0.368
Node 8: acceptance=0.421
Node 9: acceptance=0.368
Node 10: acceptance=0.368
Node 11: acceptance=0.421
Node 12: acceptance=0.421
Node 13: acceptance=0.421
Node 14: acceptance=0.421
Node 15: acceptance=0.421
Node 16: acceptance=0.368
Node 17: acceptance=0.421
Node 18: acceptance=0.421
Node 19: acceptance=0.368

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Sketch transfer: 0.000s (0.0%)
    - Model fetch (accepted): 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Sketching: 3.952s (99.4%)
    - Filtering: 0.004s (0.1%)
    - Aggregation: 0.019s (0.5%)
  TOTALS:
    - Total computation: 3.975s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 3.975s

=== PER-NODE AVERAGE TIME ===
  - Sketching: 3.548s
  - Filtering: 0.001s
  - Aggregation: 0.016s
  - Sketch transfer: 0.000s
  - Model fetch: 0.000s
  - Total per node: 3.566s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total sketching: 70.967s
  - Total filtering: 0.030s
  - Total aggregation: 0.313s
  - Total sketch transfer: 0.000s
  - Total model fetch: 0.000s
  - Grand total: 71.310s
  - Mean acceptance rate: 0.400

Sketchguard Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

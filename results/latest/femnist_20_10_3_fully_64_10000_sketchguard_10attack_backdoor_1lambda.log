Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Degree statistics: avg=19.00, min=19, max=19
Attack: Compromised 2/20 nodes: [5, 13]
Attack type: backdoor, lambda: 1.0
Backdoor target label: 0, trigger size: 4
Model variant: baseline
Model parameters: 6,603,710
Sketchguard Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
Sketchguard ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Config: SketchguardConfig(gamma=2, kappa=1, alpha=0.5, min_neighbors=1, sketch_size=1000, network_seed=987654321, attack_detection_window=5)
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0168 ± 0.0139
Backdoor attack: Created poisoned datasets for 2 compromised nodes
Round 001: test acc mean=0.4824 ± 0.1224 | min=0.0491 max=0.5670
         : test loss mean=1517.8127 ± 4659.8784
         : individual accs = ['0.564438', '0.519153', '0.567018', '0.531272', '0.525299', '0.213902', '0.523969', '0.506783', '0.526127', '0.473229', '0.544533', '0.527069', '0.465429', '0.049083', '0.540474', '0.536858', '0.486395', '0.528329', '0.512977', '0.505572']
         : correct/total = [(2330, 4128), (2182, 4203), (2314, 4081), (2302, 4333), (2149, 4091), (917, 4287), (2197, 4193), (2204, 4349), (2205, 4191), (2024, 4277), (2256, 4143), (2210, 4193), (1905, 4093), (206, 4197), (2190, 4052), (2163, 4029), (2020, 4153), (2210, 4183), (2095, 4084), (2087, 4128)]
         : compromised: 0.1315, honest: 0.5214
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 002: test acc mean=0.6214 ± 0.1916 | min=0.0457 max=0.7155
         : test loss mean=464.7594 ± 1989.1465
         : individual accs = ['0.694041', '0.678087', '0.690027', '0.699746', '0.694696', '0.050618', '0.659909', '0.685905', '0.678836', '0.668927', '0.708424', '0.681374', '0.678475', '0.045747', '0.697187', '0.662447', '0.680954', '0.715515', '0.685113', '0.671512']
         : correct/total = [(2865, 4128), (2850, 4203), (2816, 4081), (3032, 4333), (2842, 4091), (217, 4287), (2767, 4193), (2983, 4349), (2845, 4191), (2861, 4277), (2935, 4143), (2857, 4193), (2777, 4093), (192, 4197), (2825, 4052), (2669, 4029), (2828, 4153), (2993, 4183), (2798, 4084), (2772, 4128)]
         : compromised: 0.0482, honest: 0.6851
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 003: test acc mean=0.6428 ± 0.1987 | min=0.0491 max=0.7356
         : test loss mean=nan ± nan
         : individual accs = ['0.727713', '0.703545', '0.698358', '0.722132', '0.726962', '0.052484', '0.695922', '0.735571', '0.712479', '0.722469', '0.729423', '0.680420', '0.721964', '0.049083', '0.714215', '0.702656', '0.684565', '0.632799', '0.727228', '0.716570']
         : correct/total = [(3004, 4128), (2957, 4203), (2850, 4081), (3129, 4333), (2974, 4091), (225, 4287), (2918, 4193), (3199, 4349), (2986, 4191), (3090, 4277), (3022, 4143), (2853, 4193), (2955, 4093), (206, 4197), (2894, 4052), (2831, 4029), (2843, 4153), (2647, 4183), (2970, 4084), (2958, 4128)]
         : compromised: 0.0508, honest: 0.7086
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 004: test acc mean=0.6305 ± 0.1944 | min=0.0491 max=0.7319
         : test loss mean=nan ± nan
         : individual accs = ['0.702762', '0.731858', '0.683901', '0.691438', '0.717673', '0.052484', '0.696876', '0.712578', '0.708900', '0.669628', '0.671253', '0.703554', '0.648668', '0.049083', '0.702863', '0.687516', '0.730075', '0.675592', '0.713026', '0.660126']
         : correct/total = [(2901, 4128), (3076, 4203), (2791, 4081), (2996, 4333), (2936, 4091), (225, 4287), (2922, 4193), (3099, 4349), (2971, 4191), (2864, 4277), (2781, 4143), (2950, 4193), (2655, 4093), (206, 4197), (2848, 4052), (2770, 4029), (3032, 4153), (2826, 4183), (2912, 4084), (2725, 4128)]
         : compromised: 0.0508, honest: 0.6949
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 005: test acc mean=0.5941 ± 0.1847 | min=0.0453 max=0.7121
         : test loss mean=nan ± nan
         : individual accs = ['0.663275', '0.663574', '0.608674', '0.617586', '0.701051', '0.045253', '0.664918', '0.712118', '0.645669', '0.674538', '0.645909', '0.662056', '0.601759', '0.049083', '0.647581', '0.612807', '0.683843', '0.656228', '0.696131', '0.630572']
         : correct/total = [(2738, 4128), (2789, 4203), (2484, 4081), (2676, 4333), (2868, 4091), (194, 4287), (2788, 4193), (3097, 4349), (2706, 4191), (2885, 4277), (2676, 4143), (2776, 4193), (2463, 4093), (206, 4197), (2624, 4052), (2469, 4029), (2840, 4153), (2745, 4183), (2843, 4084), (2603, 4128)]
         : compromised: 0.0472, honest: 0.6549
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 006: test acc mean=0.6361 ± 0.1980 | min=0.0453 max=0.7372
         : test loss mean=nan ± nan
         : individual accs = ['0.695010', '0.716869', '0.677775', '0.643896', '0.734295', '0.045253', '0.727164', '0.694642', '0.685994', '0.672668', '0.695873', '0.736466', '0.665771', '0.049083', '0.737167', '0.683793', '0.732964', '0.709539', '0.728452', '0.689196']
         : correct/total = [(2869, 4128), (3013, 4203), (2766, 4081), (2790, 4333), (3004, 4091), (194, 4287), (3049, 4193), (3021, 4349), (2875, 4191), (2877, 4277), (2883, 4143), (3088, 4193), (2725, 4093), (206, 4197), (2987, 4052), (2755, 4029), (3044, 4153), (2968, 4183), (2975, 4084), (2845, 4128)]
         : compromised: 0.0472, honest: 0.7015
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 007: test acc mean=0.7089 ± 0.2209 | min=0.0453 max=0.8069
         : test loss mean=nan ± nan
         : individual accs = ['0.790940', '0.787771', '0.773585', '0.774983', '0.806893', '0.045253', '0.782018', '0.793516', '0.778812', '0.784662', '0.758146', '0.778679', '0.789641', '0.049083', '0.785291', '0.758253', '0.791476', '0.775281', '0.797258', '0.777374']
         : correct/total = [(3265, 4128), (3311, 4203), (3157, 4081), (3358, 4333), (3301, 4091), (194, 4287), (3279, 4193), (3451, 4349), (3264, 4191), (3356, 4277), (3141, 4143), (3265, 4193), (3232, 4093), (206, 4197), (3182, 4052), (3055, 4029), (3287, 4153), (3243, 4183), (3256, 4084), (3209, 4128)]
         : compromised: 0.0472, honest: 0.7825
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 008: test acc mean=0.7427 ± 0.2320 | min=0.0453 max=0.8328
         : test loss mean=nan ± nan
         : individual accs = ['0.820979', '0.827504', '0.824063', '0.821371', '0.826204', '0.045253', '0.812545', '0.832835', '0.817227', '0.830489', '0.814627', '0.816599', '0.824090', '0.049083', '0.809477', '0.805659', '0.822297', '0.811379', '0.826885', '0.816134']
         : correct/total = [(3389, 4128), (3478, 4203), (3363, 4081), (3559, 4333), (3380, 4091), (194, 4287), (3407, 4193), (3622, 4349), (3425, 4191), (3552, 4277), (3375, 4143), (3424, 4193), (3373, 4093), (206, 4197), (3280, 4052), (3246, 4029), (3415, 4153), (3394, 4183), (3377, 4084), (3369, 4128)]
         : compromised: 0.0472, honest: 0.8200
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 009: test acc mean=0.7531 ± 0.2354 | min=0.0453 max=0.8466
         : test loss mean=nan ± nan
         : individual accs = ['0.825581', '0.836783', '0.842441', '0.832449', '0.836715', '0.045253', '0.824708', '0.846631', '0.826533', '0.841010', '0.824523', '0.823515', '0.835329', '0.049083', '0.826259', '0.822537', '0.837226', '0.826918', '0.833007', '0.824855']
         : correct/total = [(3408, 4128), (3517, 4203), (3438, 4081), (3607, 4333), (3423, 4091), (194, 4287), (3458, 4193), (3682, 4349), (3464, 4191), (3597, 4277), (3416, 4143), (3453, 4193), (3419, 4093), (206, 4197), (3348, 4052), (3314, 4029), (3477, 4153), (3459, 4183), (3402, 4084), (3405, 4128)]
         : compromised: 0.0472, honest: 0.8315
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...
Round 010: test acc mean=0.7591 ± 0.2374 | min=0.0453 max=0.8487
         : test loss mean=nan ± nan
         : individual accs = ['0.838178', '0.842969', '0.843176', '0.840295', '0.846737', '0.045253', '0.833055', '0.848701', '0.836555', '0.844985', '0.833937', '0.823992', '0.841925', '0.049083', '0.830948', '0.829983', '0.848543', '0.833134', '0.844515', '0.826550']
         : correct/total = [(3460, 4128), (3543, 4203), (3441, 4081), (3641, 4333), (3464, 4091), (194, 4287), (3493, 4193), (3691, 4349), (3506, 4191), (3614, 4277), (3455, 4143), (3455, 4193), (3446, 4093), (206, 4197), (3367, 4052), (3344, 4029), (3524, 4153), (3485, 4183), (3449, 4084), (3412, 4128)]
         : compromised: 0.0472, honest: 0.8382
         : sketchguard stats = ['Node 0: acc_rate=0.895', 'Node 1: acc_rate=0.895', 'Node 2: acc_rate=0.895']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: sketchguard
Attack: backdoor, 10.0% compromised
Final accuracy - Compromised: 0.0472, Honest: 0.8382
Overall test accuracy: mean=0.7591 ± 0.2374

=== BACKDOOR ATTACK SUCCESS RATE (ASR) ===
Target label: 0
Trigger size: 4x4
Overall ASR: 0.1480 ± 0.2840
Honest nodes ASR: 0.0533 ± 0.0049
Compromised nodes ASR: 1.0000 ± 0.0000
Note: Higher ASR indicates more successful backdoor attack

=== Sketchguard SUMMARY ===
Node 0: acceptance=0.895
Node 1: acceptance=0.895
Node 2: acceptance=0.895
Node 3: acceptance=0.895
Node 4: acceptance=0.895
Node 5: acceptance=0.395
Node 6: acceptance=0.895
Node 7: acceptance=0.895
Node 8: acceptance=0.895
Node 9: acceptance=0.895
Node 10: acceptance=0.895
Node 11: acceptance=0.895
Node 12: acceptance=0.895
Node 13: acceptance=0.295
Node 14: acceptance=0.895
Node 15: acceptance=0.895
Node 16: acceptance=0.895
Node 17: acceptance=0.895
Node 18: acceptance=0.895
Node 19: acceptance=0.895

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Sketch transfer: 0.000s (0.0%)
    - Model fetch (accepted): 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Sketching: 6.100s (99.5%)
    - Filtering: 0.002s (0.0%)
    - Aggregation: 0.031s (0.5%)
  TOTALS:
    - Total computation: 6.133s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 6.133s

=== PER-NODE AVERAGE TIME ===
  - Sketching: 5.751s
  - Filtering: 0.001s
  - Aggregation: 0.025s
  - Sketch transfer: 0.000s
  - Model fetch: 0.000s
  - Total per node: 5.778s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total sketching: 115.023s
  - Total filtering: 0.028s
  - Total aggregation: 0.502s
  - Total sketch transfer: 0.000s
  - Total model fetch: 0.000s
  - Grand total: 115.553s
  - Mean acceptance rate: 0.840

Sketchguard Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

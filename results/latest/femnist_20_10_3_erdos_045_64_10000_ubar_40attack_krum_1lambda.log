Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 99
Degree statistics: avg=9.90, min=7, max=14
Attack: Compromised 8/20 nodes: [1, 5, 11, 12, 13, 14, 17, 18]
Attack type: krum, lambda: 1.0
Model variant: baseline
Model parameters: 6,603,710
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.6
  - Stage 1: Distance-based filtering (select 60% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4062 ± 0.0533 | min=0.2754 max=0.5248
         : test loss mean=3.7119 ± 0.0725
         : individual accs = ['0.402374', '0.428266', '0.418525', '0.375490', '0.430213', '0.524843', '0.410684', '0.371120', '0.413982', '0.387421', '0.396814', '0.363940', '0.434889', '0.440791', '0.293189', '0.455944', '0.417289', '0.275400', '0.435602', '0.446463']
         : correct/total = [(1661, 4128), (1800, 4203), (1708, 4081), (1627, 4333), (1760, 4091), (2250, 4287), (1722, 4193), (1614, 4349), (1735, 4191), (1657, 4277), (1644, 4143), (1526, 4193), (1780, 4093), (1850, 4197), (1188, 4052), (1837, 4029), (1733, 4153), (1152, 4183), (1779, 4084), (1843, 4128)]
         : compromised: 0.3996, honest: 0.4105
         : ubar stats = ['Node 0: s1=0.583, s2=0.143', 'Node 1: s1=0.600, s2=0.500', 'Node 2: s1=0.500, s2=0.500']...
Round 002: test acc mean=0.6707 ± 0.0252 | min=0.6079 max=0.7233
         : test loss mean=2.9076 ± 0.6890
         : individual accs = ['0.680717', '0.669760', '0.654006', '0.607893', '0.682718', '0.656170', '0.659909', '0.702920', '0.646385', '0.684124', '0.690321', '0.667780', '0.659663', '0.659280', '0.708045', '0.723256', '0.682639', '0.638776', '0.676787', '0.663033']
         : correct/total = [(2810, 4128), (2815, 4203), (2669, 4081), (2634, 4333), (2793, 4091), (2813, 4287), (2767, 4193), (3057, 4349), (2709, 4191), (2926, 4277), (2860, 4143), (2800, 4193), (2700, 4093), (2767, 4197), (2869, 4052), (2914, 4029), (2835, 4153), (2672, 4183), (2764, 4084), (2737, 4128)]
         : compromised: 0.6670, honest: 0.6732
         : ubar stats = ['Node 0: s1=0.583, s2=0.357', 'Node 1: s1=0.600, s2=0.667', 'Node 2: s1=0.500, s2=0.625']...
Round 003: test acc mean=0.6699 ± 0.0724 | min=0.4780 max=0.7501
         : test loss mean=2.3969 ± 0.6330
         : individual accs = ['0.521076', '0.677373', '0.676060', '0.750058', '0.718651', '0.716352', '0.692583', '0.478041', '0.702219', '0.549918', '0.736906', '0.635822', '0.687760', '0.695020', '0.638203', '0.723505', '0.740429', '0.643557', '0.708374', '0.706638']
         : correct/total = [(2151, 4128), (2847, 4203), (2759, 4081), (3250, 4333), (2940, 4091), (3071, 4287), (2904, 4193), (2079, 4349), (2943, 4191), (2352, 4277), (3053, 4143), (2666, 4193), (2815, 4093), (2917, 4197), (2586, 4052), (2915, 4029), (3075, 4153), (2692, 4183), (2893, 4084), (2917, 4128)]
         : compromised: 0.6753, honest: 0.6663
         : ubar stats = ['Node 0: s1=0.583, s2=0.333', 'Node 1: s1=0.600, s2=0.611', 'Node 2: s1=0.500, s2=0.583']...
Round 004: test acc mean=0.7395 ± 0.0479 | min=0.6227 max=0.8039
         : test loss mean=1.4871 ± 0.6559
         : individual accs = ['0.767684', '0.672853', '0.758883', '0.771521', '0.776827', '0.737812', '0.708323', '0.753277', '0.790742', '0.780454', '0.737388', '0.764369', '0.673589', '0.716464', '0.696693', '0.803922', '0.793162', '0.686110', '0.622674', '0.778101']
         : correct/total = [(3169, 4128), (2828, 4203), (3097, 4081), (3343, 4333), (3178, 4091), (3163, 4287), (2970, 4193), (3276, 4349), (3314, 4191), (3338, 4277), (3055, 4143), (3205, 4193), (2757, 4093), (3007, 4197), (2823, 4052), (3239, 4029), (3294, 4153), (2870, 4183), (2543, 4084), (3212, 4128)]
         : compromised: 0.6963, honest: 0.7684
         : ubar stats = ['Node 0: s1=0.583, s2=0.321', 'Node 1: s1=0.600, s2=0.625', 'Node 2: s1=0.500, s2=0.500']...
Round 005: test acc mean=0.7801 ± 0.0342 | min=0.6811 max=0.8170
         : test loss mean=1.0145 ± 0.4319
         : individual accs = ['0.773014', '0.737568', '0.795883', '0.739672', '0.804449', '0.808724', '0.771762', '0.681076', '0.816989', '0.811316', '0.794352', '0.793227', '0.800880', '0.722183', '0.803060', '0.813353', '0.773898', '0.792015', '0.786484', '0.781734']
         : correct/total = [(3191, 4128), (3100, 4203), (3248, 4081), (3205, 4333), (3291, 4091), (3467, 4287), (3236, 4193), (2962, 4349), (3424, 4191), (3470, 4277), (3291, 4143), (3326, 4193), (3278, 4093), (3031, 4197), (3254, 4052), (3277, 4029), (3214, 4153), (3313, 4183), (3212, 4084), (3227, 4128)]
         : compromised: 0.7805, honest: 0.7798
         : ubar stats = ['Node 0: s1=0.583, s2=0.286', 'Node 1: s1=0.600, s2=0.667', 'Node 2: s1=0.500, s2=0.500']...
Round 006: test acc mean=0.8103 ± 0.0087 | min=0.7957 max=0.8270
         : test loss mean=0.6935 ± 0.1316
         : individual accs = ['0.804748', '0.801808', '0.807400', '0.812370', '0.797360', '0.804292', '0.818507', '0.816739', '0.820568', '0.812252', '0.804007', '0.813976', '0.795749', '0.799381', '0.826999', '0.823033', '0.815796', '0.818551', '0.809011', '0.803537']
         : correct/total = [(3322, 4128), (3370, 4203), (3295, 4081), (3520, 4333), (3262, 4091), (3448, 4287), (3432, 4193), (3552, 4349), (3439, 4191), (3474, 4277), (3331, 4143), (3413, 4193), (3257, 4093), (3355, 4197), (3351, 4052), (3316, 4029), (3388, 4153), (3424, 4183), (3304, 4084), (3317, 4128)]
         : compromised: 0.8087, honest: 0.8114
         : ubar stats = ['Node 0: s1=0.583, s2=0.262', 'Node 1: s1=0.600, s2=0.639', 'Node 2: s1=0.500, s2=0.458']...
Round 007: test acc mean=0.8208 ± 0.0132 | min=0.7868 max=0.8334
         : test loss mean=0.6688 ± 0.2122
         : individual accs = ['0.819041', '0.832501', '0.828473', '0.833372', '0.810071', '0.792396', '0.830670', '0.829846', '0.832975', '0.830956', '0.810282', '0.827808', '0.806010', '0.825828', '0.813919', '0.830975', '0.829762', '0.821181', '0.823213', '0.786822']
         : correct/total = [(3381, 4128), (3499, 4203), (3381, 4081), (3611, 4333), (3314, 4091), (3397, 4287), (3483, 4193), (3609, 4349), (3491, 4191), (3554, 4277), (3357, 4143), (3471, 4193), (3299, 4093), (3466, 4197), (3298, 4052), (3348, 4029), (3446, 4153), (3435, 4183), (3362, 4084), (3248, 4128)]
         : compromised: 0.8179, honest: 0.8228
         : ubar stats = ['Node 0: s1=0.583, s2=0.245', 'Node 1: s1=0.600, s2=0.643', 'Node 2: s1=0.500, s2=0.429']...
Round 008: test acc mean=0.8281 ± 0.0093 | min=0.8062 max=0.8408
         : test loss mean=0.5603 ± 0.0869
         : individual accs = ['0.819525', '0.826315', '0.821612', '0.840757', '0.827915', '0.831117', '0.839971', '0.833295', '0.810785', '0.836801', '0.825006', '0.832101', '0.816272', '0.831070', '0.838351', '0.839166', '0.827354', '0.827875', '0.830069', '0.806202']
         : correct/total = [(3383, 4128), (3473, 4203), (3353, 4081), (3643, 4333), (3387, 4091), (3563, 4287), (3522, 4193), (3624, 4349), (3398, 4191), (3579, 4277), (3418, 4143), (3489, 4193), (3341, 4093), (3488, 4197), (3397, 4052), (3381, 4029), (3436, 4153), (3463, 4183), (3390, 4084), (3328, 4128)]
         : compromised: 0.8291, honest: 0.8274
         : ubar stats = ['Node 0: s1=0.583, s2=0.268', 'Node 1: s1=0.600, s2=0.583', 'Node 2: s1=0.500, s2=0.406']...
Round 009: test acc mean=0.8389 ± 0.0061 | min=0.8260 max=0.8454
         : test loss mean=0.4973 ± 0.0201
         : individual accs = ['0.831880', '0.842731', '0.837295', '0.845373', '0.827915', '0.843480', '0.844980', '0.845022', '0.844906', '0.841711', '0.825972', '0.843310', '0.836550', '0.841553', '0.842794', '0.844130', '0.836504', '0.838633', '0.833986', '0.828973']
         : correct/total = [(3434, 4128), (3542, 4203), (3417, 4081), (3663, 4333), (3387, 4091), (3616, 4287), (3543, 4193), (3675, 4349), (3541, 4191), (3600, 4277), (3422, 4143), (3536, 4193), (3424, 4093), (3532, 4197), (3415, 4052), (3401, 4029), (3474, 4153), (3508, 4183), (3406, 4084), (3422, 4128)]
         : compromised: 0.8404, honest: 0.8379
         : ubar stats = ['Node 0: s1=0.583, s2=0.254', 'Node 1: s1=0.600, s2=0.537', 'Node 2: s1=0.500, s2=0.389']...
Round 010: test acc mean=0.8409 ± 0.0056 | min=0.8308 max=0.8506
         : test loss mean=0.4834 ± 0.0197
         : individual accs = ['0.835998', '0.850107', '0.834109', '0.845834', '0.830848', '0.843014', '0.847126', '0.843182', '0.841327', '0.839841', '0.831282', '0.840448', '0.838993', '0.842983', '0.843287', '0.850583', '0.839634', '0.847478', '0.835700', '0.836240']
         : correct/total = [(3451, 4128), (3573, 4203), (3404, 4081), (3665, 4333), (3399, 4091), (3614, 4287), (3552, 4193), (3667, 4349), (3526, 4191), (3592, 4277), (3444, 4143), (3524, 4193), (3434, 4093), (3538, 4197), (3417, 4052), (3427, 4029), (3487, 4153), (3545, 4183), (3413, 4084), (3452, 4128)]
         : compromised: 0.8428, honest: 0.8397
         : ubar stats = ['Node 0: s1=0.583, s2=0.243', 'Node 1: s1=0.600, s2=0.500', 'Node 2: s1=0.500, s2=0.375']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: ubar
Attack: krum, 40.0% compromised
Final accuracy - Compromised: 0.8428, Honest: 0.8397
Overall test accuracy: mean=0.8409 ± 0.0056

=== UBAR SUMMARY ===
Node 0: stage1=0.583, stage2=0.243, overall=0.142
Node 1: stage1=0.600, stage2=0.500, overall=0.300
Node 2: stage1=0.500, stage2=0.375, overall=0.188
Node 3: stage1=0.571, stage2=0.400, overall=0.229
Node 4: stage1=0.556, stage2=0.380, overall=0.211
Node 5: stage1=0.600, stage2=0.317, overall=0.190
Node 6: stage1=0.583, stage2=0.200, overall=0.117
Node 7: stage1=0.545, stage2=0.217, overall=0.118
Node 8: stage1=0.571, stage2=0.300, overall=0.171
Node 9: stage1=0.545, stage2=0.400, overall=0.218
Node 10: stage1=0.500, stage2=0.475, overall=0.237
Node 11: stage1=0.583, stage2=0.243, overall=0.142
Node 12: stage1=0.583, stage2=0.457, overall=0.267
Node 13: stage1=0.556, stage2=0.540, overall=0.300
Node 14: stage1=0.571, stage2=0.338, overall=0.193
Node 15: stage1=0.556, stage2=0.240, overall=0.133
Node 16: stage1=0.571, stage2=0.400, overall=0.229
Node 17: stage1=0.500, stage2=0.450, overall=0.225
Node 18: stage1=0.583, stage2=0.371, overall=0.217
Node 19: stage1=0.600, stage2=0.367, overall=0.220

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Full model transfer: 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Distance computation: 0.047s (1.1%)
    - Loss computation: 4.316s (98.8%)
    - Aggregation: 0.007s (0.2%)
  TOTALS:
    - Total computation: 4.370s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 4.370s

=== PER-NODE AVERAGE TIME ===
  - Distance computation: 0.036s
  - Loss computation: 4.055s
  - Aggregation: 0.005s
  - Model transfer: 0.000s
  - Total per node: 4.096s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total distance computation: 0.720s
  - Total loss computation: 81.101s
  - Total aggregation: 0.108s
  - Total model transfer: 0.000s
  - Grand total: 81.929s
  - Mean Stage 1 acceptance rate: 0.563
  - Mean Stage 2 acceptance rate: 0.361
  - Overall acceptance rate: 0.203

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.6
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 60% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

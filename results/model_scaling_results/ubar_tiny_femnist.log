# Model Scaling Experiment
# Algorithm: ubar
# Model variant: tiny
# Dataset: femnist
# Timestamp: 2025-09-23T03:15:21.725882
# Device: CPU (forced for consistent performance)
# Command: python decentralized_fl_sim.py --dataset femnist --model-variant tiny --rounds 3 --local-epochs 1 --seed 42 --batch-size 32 --lr 0.01 --agg ubar --ubar-rho 0.4 --attack-percentage 0.5 --attack-type directed_deviation --verbose --graph ring --num-nodes 20
================================================================================

Device: cpu
Seed: 42
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [37676, 37670, 37261, 34625, 36810, 35667, 37466, 36404, 36175, 36710, 37122, 37538, 35969, 37590, 36705, 36474, 36699, 37182, 36951, 35769]
Test partition sizes: [4275, 4276, 4227, 3941, 4171, 4051, 4253, 4138, 4112, 4169, 4218, 4252, 4082, 4263, 4169, 4143, 4173, 4221, 4187, 4067]
  Client 0: 37676 train samples, 62 unique classes
  Client 1: 37670 train samples, 62 unique classes
  Client 2: 37261 train samples, 62 unique classes
  Client 3: 34625 train samples, 62 unique classes
  Client 4: 36810 train samples, 62 unique classes
  Client 5: 35667 train samples, 62 unique classes
  Client 6: 37466 train samples, 62 unique classes
  Client 7: 36404 train samples, 62 unique classes
  Client 8: 36175 train samples, 62 unique classes
  Client 9: 36710 train samples, 62 unique classes
  Client 10: 37122 train samples, 62 unique classes
  Client 11: 37538 train samples, 62 unique classes
  Client 12: 35969 train samples, 62 unique classes
  Client 13: 37590 train samples, 62 unique classes
  Client 14: 36705 train samples, 62 unique classes
  Client 15: 36474 train samples, 62 unique classes
  Client 16: 36699 train samples, 62 unique classes
  Client 17: 37182 train samples, 62 unique classes
  Client 18: 36951 train samples, 62 unique classes
  Client 19: 35769 train samples, 62 unique classes
Graph: ring, nodes: 20, edges: 20
Degree statistics: avg=2.00, min=2, max=2
Attack: Compromised 10/20 nodes: [0, 1, 2, 3, 7, 8, 10, 11, 16, 17]
Attack type: directed_deviation, lambda: 1.0
Model variant: tiny
Model parameters: 220,318
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 220,318 parameters
  - Rho parameter: 0.4
  - Stage 1: Distance-based filtering (select 40% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0124 ± 0.0103
Round 001: test acc mean=0.3375 ± 0.1522 | min=0.0066 max=0.5109
         : test loss mean=255.5391 ± 652.1296
         : individual accs = ['0.395088', '0.008887', '0.006624', '0.207308', '0.436586', '0.381140', '0.399718', '0.510875', '0.387889', '0.050132', '0.230204', '0.438852', '0.371877', '0.396434', '0.404174', '0.468260', '0.481428', '0.499408', '0.338906', '0.336858']
         : correct/total = [(1689, 4275), (38, 4276), (28, 4227), (817, 3941), (1821, 4171), (1544, 4051), (1700, 4253), (2114, 4138), (1595, 4112), (209, 4169), (971, 4218), (1866, 4252), (1518, 4082), (1690, 4263), (1685, 4169), (1940, 4143), (2009, 4173), (2108, 4221), (1419, 4187), (1370, 4067)]
         : compromised: 0.3167, honest: 0.3584
         : ubar stats = ['Node 0: s1=0.500, s2=1.000', 'Node 1: s1=0.500, s2=1.000', 'Node 2: s1=0.500, s2=1.000']...
Round 002: test acc mean=0.5459 ± 0.2952 | min=0.0076 max=0.7872
         : test loss mean=1249.6757 ± 5423.6277
         : individual accs = ['0.658947', '0.048644', '0.007570', '0.673433', '0.747063', '0.780548', '0.782036', '0.627840', '0.053988', '0.056848', '0.060929', '0.612183', '0.685938', '0.787239', '0.783401', '0.585807', '0.735442', '0.661692', '0.784332', '0.783378']
         : correct/total = [(2817, 4275), (208, 4276), (32, 4227), (2654, 3941), (3116, 4171), (3162, 4051), (3326, 4253), (2598, 4138), (222, 4112), (237, 4169), (257, 4218), (2603, 4252), (2800, 4082), (3356, 4263), (3266, 4169), (2427, 4143), (3069, 4173), (2793, 4221), (3284, 4187), (3186, 4067)]
         : compromised: 0.4141, honest: 0.6777
         : ubar stats = ['Node 0: s1=0.500, s2=1.000', 'Node 1: s1=0.500, s2=1.000', 'Node 2: s1=0.500, s2=1.000']...
Round 003: test acc mean=0.6086 ± 0.3256 | min=0.0365 max=0.8221
         : test loss mean=3.7699 ± 6.5982
         : individual accs = ['0.778947', '0.036483', '0.046132', '0.777214', '0.822105', '0.803505', '0.811427', '0.785887', '0.048152', '0.049652', '0.046230', '0.776576', '0.794219', '0.814684', '0.810506', '0.782766', '0.763240', '0.796020', '0.815381', '0.812638']
         : correct/total = [(3330, 4275), (156, 4276), (195, 4227), (3063, 3941), (3429, 4171), (3255, 4051), (3451, 4253), (3252, 4138), (198, 4112), (207, 4169), (195, 4218), (3302, 4252), (3242, 4082), (3473, 4263), (3379, 4169), (3243, 4143), (3185, 4173), (3360, 4221), (3414, 4187), (3305, 4067)]
         : compromised: 0.4855, honest: 0.7317
         : ubar stats = ['Node 0: s1=0.500, s2=1.000', 'Node 1: s1=0.500, s2=1.000', 'Node 2: s1=0.500, s2=1.000']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: ring, Aggregation: ubar
Attack: directed_deviation, 50.0% compromised
Final accuracy - Compromised: 0.4855, Honest: 0.7317
Overall test accuracy: mean=0.6086 ± 0.3256

=== UBAR SUMMARY ===
Node 0: stage1=0.500, stage2=1.000, overall=0.500
Node 1: stage1=0.500, stage2=1.000, overall=0.500
Node 2: stage1=0.500, stage2=1.000, overall=0.500
Node 3: stage1=0.500, stage2=1.000, overall=0.500
Node 4: stage1=0.500, stage2=1.000, overall=0.500
Node 5: stage1=0.500, stage2=1.000, overall=0.500
Node 6: stage1=0.500, stage2=1.000, overall=0.500
Node 7: stage1=0.500, stage2=1.000, overall=0.500
Node 8: stage1=0.500, stage2=1.000, overall=0.500
Node 9: stage1=0.500, stage2=1.000, overall=0.500
Node 10: stage1=0.500, stage2=1.000, overall=0.500
Node 11: stage1=0.500, stage2=1.000, overall=0.500
Node 12: stage1=0.500, stage2=1.000, overall=0.500
Node 13: stage1=0.500, stage2=1.000, overall=0.500
Node 14: stage1=0.500, stage2=1.000, overall=0.500
Node 15: stage1=0.500, stage2=1.000, overall=0.500
Node 16: stage1=0.500, stage2=1.000, overall=0.500
Node 17: stage1=0.500, stage2=1.000, overall=0.500
Node 18: stage1=0.500, stage2=1.000, overall=0.500
Node 19: stage1=0.500, stage2=1.000, overall=0.500

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Full model transfer: 0.000s (0.1%)
  COMPUTATION (max across nodes):
    - Distance computation: 0.001s (5.1%)
    - Loss computation: 0.021s (89.3%)
    - Aggregation: 0.001s (5.5%)
  TOTALS:
    - Total computation: 0.024s (99.9%)
    - Total communication: 0.000s (0.1%)
    - Total parallel time: 0.024s

=== PER-NODE AVERAGE TIME ===
  - Distance computation: 0.001s
  - Loss computation: 0.005s
  - Aggregation: 0.001s
  - Model transfer: 0.000s
  - Total per node: 0.007s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total distance computation: 0.018s
  - Total loss computation: 0.110s
  - Total aggregation: 0.019s
  - Total model transfer: 0.000s
  - Grand total: 0.146s
  - Mean Stage 1 acceptance rate: 0.500
  - Mean Stage 2 acceptance rate: 1.000
  - Overall acceptance rate: 0.500

UBAR Algorithm Properties:
  - Model dimension: 220,318
  - Rho parameter: 0.4
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 40% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation


# Experiment completed successfully

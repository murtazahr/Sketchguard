Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 126
Attack: Compromised 4/20 nodes: [5, 12, 13, 17]
Attack type: directed_deviation, lambda: 1.0
COARSE Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4958 ± 0.0338 | min=0.4460 max=0.5528
         : test loss mean=3.7446 ± 0.0250
         : individual accs = ['0.552810', '0.493457', '0.515560', '0.494346', '0.451968', '0.547469', '0.485333', '0.492297', '0.534956', '0.457096', '0.449916', '0.531839', '0.463230', '0.461282', '0.507404', '0.531646', '0.469299', '0.530959', '0.498776', '0.445979']
         : correct/total = [(2282, 4128), (2074, 4203), (2104, 4081), (2142, 4333), (1849, 4091), (2347, 4287), (2035, 4193), (2141, 4349), (2242, 4191), (1955, 4277), (1864, 4143), (2230, 4193), (1896, 4093), (1936, 4197), (2056, 4052), (2142, 4029), (1949, 4153), (2221, 4183), (2037, 4084), (1841, 4128)]
         : compromised: 0.5007, honest: 0.4945
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 002: test acc mean=0.6838 ± 0.0173 | min=0.6463 max=0.7076
         : test loss mean=3.3895 ± 0.0626
         : individual accs = ['0.685320', '0.688794', '0.671404', '0.701362', '0.682229', '0.703522', '0.646315', '0.693263', '0.674302', '0.702128', '0.680666', '0.703554', '0.693868', '0.659042', '0.707552', '0.697195', '0.658319', '0.662682', '0.692948', '0.670785']
         : correct/total = [(2829, 4128), (2895, 4203), (2740, 4081), (3039, 4333), (2791, 4091), (3016, 4287), (2710, 4193), (3015, 4349), (2826, 4191), (3003, 4277), (2820, 4143), (2950, 4193), (2840, 4093), (2766, 4197), (2867, 4052), (2809, 4029), (2734, 4153), (2772, 4183), (2830, 4084), (2769, 4128)]
         : compromised: 0.6798, honest: 0.6848
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 003: test acc mean=0.7049 ± 0.0240 | min=0.6375 max=0.7362
         : test loss mean=3.0789 ± 0.1119
         : individual accs = ['0.732316', '0.720438', '0.671649', '0.736210', '0.700562', '0.637509', '0.720010', '0.725224', '0.726557', '0.695815', '0.688390', '0.729788', '0.716834', '0.680010', '0.721125', '0.705634', '0.698290', '0.679656', '0.701028', '0.710271']
         : correct/total = [(3023, 4128), (3028, 4203), (2741, 4081), (3190, 4333), (2866, 4091), (2733, 4287), (3019, 4193), (3154, 4349), (3045, 4191), (2976, 4277), (2852, 4143), (3060, 4193), (2934, 4093), (2854, 4197), (2922, 4052), (2843, 4029), (2900, 4153), (2843, 4183), (2863, 4084), (2932, 4128)]
         : compromised: 0.6785, honest: 0.7115
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 004: test acc mean=0.6952 ± 0.0326 | min=0.6140 max=0.7397
         : test loss mean=2.5575 ± 0.1601
         : individual accs = ['0.705184', '0.723293', '0.664298', '0.713132', '0.739672', '0.638908', '0.734081', '0.721545', '0.716297', '0.692775', '0.648322', '0.713809', '0.613975', '0.662616', '0.721372', '0.708613', '0.702625', '0.694478', '0.704212', '0.684593']
         : correct/total = [(2911, 4128), (3040, 4203), (2711, 4081), (3090, 4333), (3026, 4091), (2739, 4287), (3078, 4193), (3138, 4349), (3002, 4191), (2963, 4277), (2686, 4143), (2993, 4193), (2513, 4093), (2781, 4197), (2923, 4052), (2855, 4029), (2918, 4153), (2905, 4183), (2876, 4084), (2826, 4128)]
         : compromised: 0.6525, honest: 0.7059
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 005: test acc mean=0.6723 ± 0.0314 | min=0.6023 max=0.7174
         : test loss mean=1.9281 ± 0.1581
         : individual accs = ['0.707364', '0.678087', '0.621906', '0.675283', '0.701540', '0.637509', '0.680658', '0.698781', '0.682415', '0.691139', '0.669804', '0.683043', '0.629856', '0.602335', '0.665597', '0.664185', '0.715627', '0.633756', '0.717434', '0.689680']
         : correct/total = [(2920, 4128), (2850, 4203), (2538, 4081), (2926, 4333), (2870, 4091), (2733, 4287), (2854, 4193), (3039, 4349), (2860, 4191), (2956, 4277), (2775, 4143), (2864, 4193), (2578, 4093), (2528, 4197), (2697, 4052), (2676, 4029), (2972, 4153), (2651, 4183), (2930, 4084), (2847, 4128)]
         : compromised: 0.6259, honest: 0.6839
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 006: test acc mean=0.7293 ± 0.0157 | min=0.6940 max=0.7538
         : test loss mean=1.2341 ± 0.0889
         : individual accs = ['0.709060', '0.735665', '0.743690', '0.741519', '0.745783', '0.693958', '0.736943', '0.736491', '0.713434', '0.719897', '0.753802', '0.744336', '0.699731', '0.712652', '0.734699', '0.736907', '0.729352', '0.728425', '0.738002', '0.732316']
         : correct/total = [(2927, 4128), (3092, 4203), (3035, 4081), (3213, 4333), (3051, 4091), (2975, 4287), (3090, 4193), (3203, 4349), (2990, 4191), (3079, 4277), (3123, 4143), (3121, 4193), (2864, 4093), (2991, 4197), (2977, 4052), (2969, 4029), (3029, 4153), (3047, 4183), (3014, 4084), (3023, 4128)]
         : compromised: 0.7087, honest: 0.7345
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 007: test acc mean=0.7911 ± 0.0071 | min=0.7733 max=0.8014
         : test loss mean=0.7808 ± 0.0422
         : individual accs = ['0.790455', '0.793719', '0.782896', '0.798292', '0.781960', '0.790996', '0.800143', '0.798344', '0.792890', '0.797054', '0.789283', '0.792988', '0.773271', '0.779843', '0.795410', '0.789774', '0.796533', '0.789386', '0.801420', '0.787791']
         : correct/total = [(3263, 4128), (3336, 4203), (3195, 4081), (3459, 4333), (3199, 4091), (3391, 4287), (3355, 4193), (3472, 4349), (3323, 4191), (3409, 4277), (3270, 4143), (3325, 4193), (3165, 4093), (3273, 4197), (3223, 4052), (3182, 4029), (3308, 4153), (3302, 4183), (3273, 4084), (3252, 4128)]
         : compromised: 0.7834, honest: 0.7931
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 008: test acc mean=0.8178 ± 0.0075 | min=0.8014 max=0.8297
         : test loss mean=0.5932 ± 0.0209
         : individual accs = ['0.807897', '0.818701', '0.816222', '0.825294', '0.804449', '0.825519', '0.825662', '0.819729', '0.824147', '0.823942', '0.810041', '0.829716', '0.809431', '0.818203', '0.822063', '0.823529', '0.816277', '0.817356', '0.816846', '0.801357']
         : correct/total = [(3335, 4128), (3441, 4203), (3331, 4081), (3576, 4333), (3291, 4091), (3539, 4287), (3462, 4193), (3565, 4349), (3454, 4191), (3524, 4277), (3356, 4143), (3479, 4193), (3313, 4093), (3434, 4197), (3331, 4052), (3318, 4029), (3390, 4153), (3419, 4183), (3336, 4084), (3308, 4128)]
         : compromised: 0.8176, honest: 0.8179
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 009: test acc mean=0.8327 ± 0.0052 | min=0.8246 max=0.8449
         : test loss mean=0.5229 ± 0.0180
         : individual accs = ['0.824612', '0.835118', '0.830189', '0.837526', '0.826448', '0.833916', '0.837586', '0.835135', '0.844906', '0.838906', '0.829351', '0.832101', '0.829221', '0.832976', '0.838105', '0.837180', '0.828558', '0.826440', '0.831048', '0.825097']
         : correct/total = [(3404, 4128), (3510, 4203), (3388, 4081), (3629, 4333), (3381, 4091), (3575, 4287), (3512, 4193), (3632, 4349), (3541, 4191), (3588, 4277), (3436, 4143), (3489, 4193), (3394, 4093), (3496, 4197), (3396, 4052), (3373, 4029), (3441, 4153), (3457, 4183), (3394, 4084), (3406, 4128)]
         : compromised: 0.8306, honest: 0.8332
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...
Round 010: test acc mean=0.8407 ± 0.0049 | min=0.8306 max=0.8481
         : test loss mean=0.4911 ± 0.0182
         : individual accs = ['0.835271', '0.845586', '0.836315', '0.841680', '0.830604', '0.838582', '0.846888', '0.841343', '0.847053', '0.844985', '0.833213', '0.835679', '0.841437', '0.843460', '0.842794', '0.848101', '0.841801', '0.843653', '0.841087', '0.834787']
         : correct/total = [(3448, 4128), (3554, 4203), (3413, 4081), (3647, 4333), (3398, 4091), (3595, 4287), (3551, 4193), (3659, 4349), (3550, 4191), (3614, 4277), (3452, 4143), (3504, 4193), (3444, 4093), (3540, 4197), (3415, 4052), (3417, 4029), (3496, 4153), (3529, 4183), (3435, 4084), (3446, 4128)]
         : compromised: 0.8418, honest: 0.8404
         : sketchguard stats = ['Node 0: acc_rate=0.812', 'Node 1: acc_rate=0.818', 'Node 2: acc_rate=0.833']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: sketchguard
Attack: directed_deviation, 20.0% compromised
Final accuracy - Compromised: 0.8418, Honest: 0.8404
Overall test accuracy: mean=0.8407 ± 0.0049

=== COARSE SUMMARY ===
Node 0: acceptance=0.812
Node 1: acceptance=0.818
Node 2: acceptance=0.833
Node 3: acceptance=0.875
Node 4: acceptance=0.818
Node 5: acceptance=0.800
Node 6: acceptance=0.714
Node 7: acceptance=0.786
Node 8: acceptance=0.700
Node 9: acceptance=0.923
Node 10: acceptance=0.667
Node 11: acceptance=0.786
Node 12: acceptance=0.917
Node 13: acceptance=0.923
Node 14: acceptance=0.733
Node 15: acceptance=0.818
Node 16: acceptance=0.769
Node 17: acceptance=0.889
Node 18: acceptance=0.812
Node 19: acceptance=0.750

Performance Summary:
  - Sketching time: 14.380s (97.2%)
  - Filtering time: 0.022s (0.1%)
  - Aggregation time: 0.390s (2.6%)
  - Total time: 14.792s
  - Mean acceptance rate: 0.807

COARSE Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

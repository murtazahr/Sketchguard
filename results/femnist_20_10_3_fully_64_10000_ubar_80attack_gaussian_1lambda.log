Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Attack: Compromised 16/20 nodes: [1, 2, 3, 5, 6, 8, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19]
Attack type: gaussian, lambda: 1.0
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.19999999999999996
  - Stage 1: Distance-based filtering (select 20% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4114 ± 0.0480 | min=0.3073 max=0.5114
         : test loss mean=3.6749 ± 0.0987
         : individual accs = ['0.450581', '0.412800', '0.511394', '0.393030', '0.439501', '0.352694', '0.437157', '0.376868', '0.405393', '0.356792', '0.381849', '0.461483', '0.393110', '0.422445', '0.307256', '0.455944', '0.437033', '0.475496', '0.351126', '0.406492']
         : correct/total = [(1860, 4128), (1735, 4203), (2087, 4081), (1703, 4333), (1798, 4091), (1512, 4287), (1833, 4193), (1639, 4349), (1699, 4191), (1526, 4277), (1582, 4143), (1935, 4193), (1609, 4093), (1773, 4197), (1245, 4052), (1837, 4029), (1815, 4153), (1989, 4183), (1434, 4084), (1678, 4128)]
         : compromised: 0.4078, honest: 0.4260
         : ubar stats = ['Node 0: s1=0.158, s2=0.333', 'Node 1: s1=0.158, s2=0.333', 'Node 2: s1=0.158, s2=0.333']...
Round 002: test acc mean=0.6673 ± 0.0384 | min=0.5844 max=0.7280
         : test loss mean=2.5040 ± 0.4399
         : individual accs = ['0.686773', '0.721389', '0.666013', '0.698823', '0.631386', '0.637275', '0.628428', '0.634169', '0.727989', '0.692542', '0.584359', '0.656093', '0.716834', '0.668096', '0.671027', '0.653760', '0.686492', '0.698303', '0.687561', '0.599079']
         : correct/total = [(2835, 4128), (3032, 4203), (2718, 4081), (3028, 4333), (2583, 4091), (2732, 4287), (2635, 4193), (2758, 4349), (3051, 4191), (2962, 4277), (2421, 4143), (2751, 4193), (2934, 4093), (2804, 4197), (2719, 4052), (2634, 4029), (2851, 4153), (2921, 4183), (2808, 4084), (2473, 4128)]
         : compromised: 0.6692, honest: 0.6597
         : ubar stats = ['Node 0: s1=0.158, s2=0.333', 'Node 1: s1=0.158, s2=0.500', 'Node 2: s1=0.158, s2=0.333']...
Round 003: test acc mean=0.7526 ± 0.0256 | min=0.6924 max=0.7873
         : test loss mean=1.1523 ± 0.3626
         : individual accs = ['0.777616', '0.772305', '0.754717', '0.771982', '0.770472', '0.756473', '0.769616', '0.787307', '0.769983', '0.712649', '0.730389', '0.727641', '0.756169', '0.692399', '0.741115', '0.762968', '0.773176', '0.718623', '0.779383', '0.726017']
         : correct/total = [(3210, 4128), (3246, 4203), (3080, 4081), (3345, 4333), (3152, 4091), (3243, 4287), (3227, 4193), (3424, 4349), (3227, 4191), (3048, 4277), (3026, 4143), (3051, 4193), (3095, 4093), (2906, 4197), (3003, 4052), (3074, 4029), (3211, 4153), (3006, 4183), (3183, 4084), (2997, 4128)]
         : compromised: 0.7464, honest: 0.7771
         : ubar stats = ['Node 0: s1=0.158, s2=0.444', 'Node 1: s1=0.158, s2=0.444', 'Node 2: s1=0.158, s2=0.333']...
Round 004: test acc mean=0.7994 ± 0.0091 | min=0.7801 max=0.8123
         : test loss mean=0.6950 ± 0.0715
         : individual accs = ['0.789971', '0.805853', '0.797599', '0.805908', '0.793449', '0.796594', '0.812306', '0.808462', '0.808160', '0.806640', '0.780111', '0.793465', '0.811874', '0.804384', '0.799852', '0.802929', '0.805201', '0.792732', '0.786729', '0.785126']
         : correct/total = [(3261, 4128), (3387, 4203), (3255, 4081), (3492, 4333), (3246, 4091), (3415, 4287), (3406, 4193), (3516, 4349), (3387, 4191), (3450, 4277), (3232, 4143), (3327, 4193), (3323, 4093), (3376, 4197), (3241, 4052), (3235, 4029), (3344, 4153), (3316, 4183), (3213, 4084), (3241, 4128)]
         : compromised: 0.7994, honest: 0.7993
         : ubar stats = ['Node 0: s1=0.158, s2=0.417', 'Node 1: s1=0.158, s2=0.417', 'Node 2: s1=0.158, s2=0.333']...
Round 005: test acc mean=0.8165 ± 0.0065 | min=0.8038 max=0.8292
         : test loss mean=0.5775 ± 0.0239
         : individual accs = ['0.810562', '0.822032', '0.813526', '0.811216', '0.806404', '0.818288', '0.824469', '0.829156', '0.825817', '0.814823', '0.808110', '0.817076', '0.819692', '0.818442', '0.822804', '0.813353', '0.816037', '0.814009', '0.820274', '0.803779']
         : correct/total = [(3346, 4128), (3455, 4203), (3320, 4081), (3515, 4333), (3299, 4091), (3508, 4287), (3457, 4193), (3606, 4349), (3461, 4191), (3485, 4277), (3348, 4143), (3426, 4193), (3355, 4093), (3435, 4197), (3334, 4052), (3277, 4029), (3389, 4153), (3405, 4183), (3350, 4084), (3318, 4128)]
         : compromised: 0.8167, honest: 0.8155
         : ubar stats = ['Node 0: s1=0.158, s2=0.400', 'Node 1: s1=0.158, s2=0.400', 'Node 2: s1=0.158, s2=0.333']...
Round 006: test acc mean=0.8293 ± 0.0063 | min=0.8173 max=0.8440
         : test loss mean=0.5286 ± 0.0180
         : individual accs = ['0.820494', '0.831073', '0.821612', '0.832218', '0.826937', '0.832983', '0.823754', '0.837664', '0.843951', '0.833762', '0.819213', '0.827093', '0.827022', '0.832976', '0.830207', '0.831224', '0.829762', '0.833134', '0.833252', '0.817345']
         : correct/total = [(3387, 4128), (3493, 4203), (3353, 4081), (3606, 4333), (3383, 4091), (3571, 4287), (3454, 4193), (3643, 4349), (3537, 4191), (3566, 4277), (3394, 4143), (3468, 4193), (3385, 4093), (3496, 4197), (3364, 4052), (3349, 4029), (3446, 4153), (3485, 4183), (3403, 4084), (3374, 4128)]
         : compromised: 0.8294, honest: 0.8287
         : ubar stats = ['Node 0: s1=0.158, s2=0.389', 'Node 1: s1=0.158, s2=0.389', 'Node 2: s1=0.158, s2=0.333']...
Round 007: test acc mean=0.8373 ± 0.0065 | min=0.8219 max=0.8481
         : test loss mean=0.4978 ± 0.0203
         : individual accs = ['0.834060', '0.844635', '0.839990', '0.841911', '0.832804', '0.838115', '0.848080', '0.838354', '0.840611', '0.837035', '0.821868', '0.830670', '0.839482', '0.844651', '0.840573', '0.830975', '0.843727', '0.832895', '0.839373', '0.825581']
         : correct/total = [(3443, 4128), (3550, 4203), (3428, 4081), (3648, 4333), (3407, 4091), (3593, 4287), (3556, 4193), (3646, 4349), (3523, 4191), (3580, 4277), (3405, 4143), (3483, 4193), (3436, 4093), (3545, 4197), (3406, 4052), (3348, 4029), (3504, 4153), (3484, 4183), (3428, 4084), (3408, 4128)]
         : compromised: 0.8373, honest: 0.8372
         : ubar stats = ['Node 0: s1=0.158, s2=0.381', 'Node 1: s1=0.158, s2=0.381', 'Node 2: s1=0.158, s2=0.381']...
Round 008: test acc mean=0.8390 ± 0.0070 | min=0.8236 max=0.8492
         : test loss mean=0.4840 ± 0.0252
         : individual accs = ['0.828488', '0.843207', '0.837785', '0.837757', '0.834515', '0.839981', '0.848557', '0.847091', '0.845383', '0.849193', '0.824765', '0.843310', '0.838260', '0.837741', '0.843781', '0.844130', '0.837708', '0.834808', '0.840842', '0.823643']
         : correct/total = [(3420, 4128), (3544, 4203), (3419, 4081), (3630, 4333), (3414, 4091), (3601, 4287), (3558, 4193), (3684, 4349), (3543, 4191), (3632, 4277), (3417, 4143), (3536, 4193), (3431, 4093), (3516, 4197), (3419, 4052), (3401, 4029), (3479, 4153), (3492, 4183), (3434, 4084), (3400, 4128)]
         : compromised: 0.8396, honest: 0.8370
         : ubar stats = ['Node 0: s1=0.158, s2=0.375', 'Node 1: s1=0.158, s2=0.375', 'Node 2: s1=0.158, s2=0.375']...
Round 009: test acc mean=0.8451 ± 0.0067 | min=0.8355 max=0.8570
         : test loss mean=0.4649 ± 0.0184
         : individual accs = ['0.837936', '0.853200', '0.841705', '0.849527', '0.835493', '0.841148', '0.853327', '0.856979', '0.854927', '0.853168', '0.836592', '0.838302', '0.847056', '0.847272', '0.847236', '0.836932', '0.842283', '0.847717', '0.841577', '0.838663']
         : correct/total = [(3459, 4128), (3586, 4203), (3435, 4081), (3681, 4333), (3418, 4091), (3606, 4287), (3578, 4193), (3727, 4349), (3583, 4191), (3649, 4277), (3466, 4143), (3515, 4193), (3467, 4093), (3556, 4197), (3433, 4052), (3372, 4029), (3498, 4153), (3546, 4183), (3437, 4084), (3462, 4128)]
         : compromised: 0.8455, honest: 0.8432
         : ubar stats = ['Node 0: s1=0.158, s2=0.370', 'Node 1: s1=0.158, s2=0.444', 'Node 2: s1=0.158, s2=0.370']...
Round 010: test acc mean=0.8474 ± 0.0064 | min=0.8365 max=0.8588
         : test loss mean=0.4597 ± 0.0182
         : individual accs = ['0.838421', '0.857721', '0.844646', '0.850450', '0.837204', '0.842780', '0.853804', '0.858818', '0.852064', '0.847557', '0.839006', '0.842595', '0.845834', '0.850131', '0.849457', '0.852569', '0.849025', '0.853215', '0.845495', '0.836483']
         : correct/total = [(3461, 4128), (3605, 4203), (3447, 4081), (3685, 4333), (3425, 4091), (3613, 4287), (3580, 4193), (3735, 4349), (3571, 4191), (3625, 4277), (3476, 4143), (3533, 4193), (3462, 4093), (3568, 4197), (3442, 4052), (3435, 4029), (3526, 4153), (3569, 4183), (3453, 4084), (3453, 4128)]
         : compromised: 0.8477, honest: 0.8459
         : ubar stats = ['Node 0: s1=0.158, s2=0.367', 'Node 1: s1=0.158, s2=0.433', 'Node 2: s1=0.158, s2=0.367']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: ubar
Attack: gaussian, 80.0% compromised
Final accuracy - Compromised: 0.8477, Honest: 0.8459
Overall test accuracy: mean=0.8474 ± 0.0064

=== UBAR SUMMARY ===
Node 0: stage1=0.158, stage2=0.367, overall=0.058
Node 1: stage1=0.158, stage2=0.433, overall=0.068
Node 2: stage1=0.158, stage2=0.367, overall=0.058
Node 3: stage1=0.158, stage2=0.400, overall=0.063
Node 4: stage1=0.158, stage2=0.467, overall=0.074
Node 5: stage1=0.158, stage2=0.500, overall=0.079
Node 6: stage1=0.158, stage2=0.467, overall=0.074
Node 7: stage1=0.158, stage2=0.467, overall=0.074
Node 8: stage1=0.158, stage2=0.467, overall=0.074
Node 9: stage1=0.158, stage2=0.500, overall=0.079
Node 10: stage1=0.158, stage2=0.600, overall=0.095
Node 11: stage1=0.158, stage2=0.400, overall=0.063
Node 12: stage1=0.158, stage2=0.400, overall=0.063
Node 13: stage1=0.158, stage2=0.433, overall=0.068
Node 14: stage1=0.158, stage2=0.533, overall=0.084
Node 15: stage1=0.158, stage2=0.333, overall=0.053
Node 16: stage1=0.158, stage2=0.500, overall=0.079
Node 17: stage1=0.158, stage2=0.500, overall=0.079
Node 18: stage1=0.158, stage2=0.400, overall=0.063
Node 19: stage1=0.158, stage2=0.433, overall=0.068

Performance Summary:
  - Distance computation time: 1.617s (1.8%)
  - Loss computation time: 86.741s (98.0%)
  - Aggregation time: 0.113s (0.1%)
  - Total time: 88.471s
  - Mean Stage 1 acceptance rate: 0.158
  - Mean Stage 2 acceptance rate: 0.448
  - Overall acceptance rate: 0.071

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.19999999999999996
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 20% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

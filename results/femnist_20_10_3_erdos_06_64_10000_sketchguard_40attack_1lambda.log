Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 126
Attack: Compromised 8/20 nodes: [1, 5, 11, 12, 13, 14, 17, 18]
Attack type: directed_deviation, lambda: 1.0
COARSE Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4886 ± 0.0374 | min=0.4193 max=0.5493
         : test loss mean=3.7470 ± 0.0252
         : individual accs = ['0.548692', '0.476564', '0.508209', '0.492730', '0.432901', '0.549335', '0.467684', '0.501954', '0.522548', '0.448913', '0.419261', '0.528738', '0.457855', '0.474148', '0.501234', '0.521966', '0.458945', '0.530481', '0.488002', '0.442103']
         : correct/total = [(2265, 4128), (2003, 4203), (2074, 4081), (2135, 4333), (1771, 4091), (2355, 4287), (1961, 4193), (2183, 4349), (2190, 4191), (1920, 4277), (1737, 4143), (2217, 4193), (1874, 4093), (1990, 4197), (2031, 4052), (2103, 4029), (1906, 4153), (2219, 4183), (1993, 4084), (1825, 4128)]
         : compromised: 0.5008, honest: 0.4805
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 002: test acc mean=0.6777 ± 0.0179 | min=0.6420 max=0.7040
         : test loss mean=3.3477 ± 0.1040
         : individual accs = ['0.689438', '0.677135', '0.662583', '0.702285', '0.679540', '0.703989', '0.642022', '0.689124', '0.681699', '0.697919', '0.672701', '0.672311', '0.688737', '0.659280', '0.690523', '0.691239', '0.644835', '0.646904', '0.682419', '0.679748']
         : correct/total = [(2846, 4128), (2846, 4203), (2704, 4081), (3043, 4333), (2780, 4091), (3018, 4287), (2692, 4193), (2997, 4349), (2857, 4191), (2985, 4277), (2787, 4143), (2819, 4193), (2819, 4093), (2767, 4197), (2798, 4052), (2785, 4029), (2678, 4153), (2706, 4183), (2787, 4084), (2806, 4128)]
         : compromised: 0.6777, honest: 0.6778
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 003: test acc mean=0.6908 ± 0.0259 | min=0.6268 max=0.7471
         : test loss mean=2.9456 ± 0.2093
         : individual accs = ['0.719234', '0.677373', '0.654496', '0.747057', '0.693718', '0.626779', '0.721440', '0.711888', '0.709616', '0.694646', '0.698045', '0.678035', '0.690691', '0.683584', '0.703850', '0.684537', '0.683121', '0.653359', '0.684133', '0.701308']
         : correct/total = [(2969, 4128), (2847, 4203), (2671, 4081), (3237, 4333), (2838, 4091), (2687, 4287), (3025, 4193), (3096, 4349), (2974, 4191), (2971, 4277), (2892, 4143), (2843, 4193), (2827, 4093), (2869, 4197), (2852, 4052), (2758, 4029), (2837, 4153), (2733, 4183), (2794, 4084), (2895, 4128)]
         : compromised: 0.6747, honest: 0.7016
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 004: test acc mean=0.6786 ± 0.0383 | min=0.6008 max=0.7378
         : test loss mean=2.2929 ± 0.2689
         : individual accs = ['0.695494', '0.635498', '0.658907', '0.737826', '0.733073', '0.613483', '0.725733', '0.714877', '0.730613', '0.690905', '0.661357', '0.650370', '0.600782', '0.668335', '0.665350', '0.717796', '0.679509', '0.671289', '0.654750', '0.666667']
         : correct/total = [(2871, 4128), (2671, 4203), (2689, 4081), (3197, 4333), (2999, 4091), (2630, 4287), (3043, 4193), (3109, 4349), (3062, 4191), (2955, 4277), (2740, 4143), (2727, 4193), (2459, 4093), (2805, 4197), (2696, 4052), (2892, 4029), (2822, 4153), (2808, 4183), (2674, 4084), (2752, 4128)]
         : compromised: 0.6450, honest: 0.7011
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 005: test acc mean=0.6959 ± 0.0366 | min=0.6043 max=0.7434
         : test loss mean=1.5770 ± 0.2111
         : individual accs = ['0.703731', '0.604330', '0.699338', '0.743365', '0.712051', '0.697691', '0.699022', '0.729363', '0.725125', '0.733224', '0.719527', '0.660148', '0.677010', '0.647129', '0.627098', '0.709357', '0.739225', '0.671528', '0.700784', '0.718266']
         : correct/total = [(2905, 4128), (2540, 4203), (2854, 4081), (3221, 4333), (2913, 4091), (2991, 4287), (2931, 4193), (3172, 4349), (3039, 4191), (3136, 4277), (2981, 4143), (2768, 4193), (2771, 4093), (2716, 4197), (2541, 4052), (2858, 4029), (3070, 4153), (2809, 4183), (2862, 4084), (2965, 4128)]
         : compromised: 0.6607, honest: 0.7193
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 006: test acc mean=0.7731 ± 0.0126 | min=0.7468 max=0.7962
         : test loss mean=0.9254 ± 0.0779
         : individual accs = ['0.761628', '0.746847', '0.787307', '0.796215', '0.769738', '0.770935', '0.769616', '0.791216', '0.771176', '0.786065', '0.786145', '0.767231', '0.760323', '0.760067', '0.761599', '0.775379', '0.791717', '0.771934', '0.763712', '0.773498']
         : correct/total = [(3144, 4128), (3139, 4203), (3213, 4081), (3450, 4333), (3149, 4091), (3305, 4287), (3227, 4193), (3441, 4349), (3232, 4191), (3362, 4277), (3257, 4143), (3217, 4193), (3112, 4093), (3190, 4197), (3086, 4052), (3124, 4029), (3288, 4153), (3229, 4183), (3119, 4084), (3193, 4128)]
         : compromised: 0.7628, honest: 0.7800
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 007: test acc mean=0.8129 ± 0.0055 | min=0.8033 max=0.8243
         : test loss mean=0.6391 ± 0.0258
         : individual accs = ['0.806202', '0.813704', '0.813281', '0.820679', '0.804938', '0.810823', '0.814930', '0.824327', '0.819136', '0.819733', '0.809800', '0.814214', '0.803323', '0.813200', '0.812438', '0.811616', '0.819167', '0.809945', '0.811704', '0.805717']
         : correct/total = [(3328, 4128), (3420, 4203), (3319, 4081), (3556, 4333), (3293, 4091), (3476, 4287), (3417, 4193), (3585, 4349), (3433, 4191), (3506, 4277), (3355, 4143), (3414, 4193), (3288, 4093), (3413, 4197), (3292, 4052), (3270, 4029), (3402, 4153), (3388, 4183), (3315, 4084), (3326, 4128)]
         : compromised: 0.8112, honest: 0.8141
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 008: test acc mean=0.8256 ± 0.0073 | min=0.8069 max=0.8381
         : test loss mean=0.5474 ± 0.0196
         : individual accs = ['0.815407', '0.827504', '0.826513', '0.830602', '0.816915', '0.831351', '0.827093', '0.835135', '0.828203', '0.827449', '0.817524', '0.828762', '0.819936', '0.826066', '0.838105', '0.828493', '0.820130', '0.833134', '0.826151', '0.806928']
         : correct/total = [(3366, 4128), (3478, 4203), (3373, 4081), (3599, 4333), (3342, 4091), (3564, 4287), (3468, 4193), (3632, 4349), (3471, 4191), (3539, 4277), (3387, 4143), (3475, 4193), (3356, 4093), (3467, 4197), (3396, 4052), (3338, 4029), (3406, 4153), (3485, 4183), (3374, 4084), (3331, 4128)]
         : compromised: 0.8289, honest: 0.8234
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 009: test acc mean=0.8372 ± 0.0054 | min=0.8287 max=0.8494
         : test loss mean=0.5010 ± 0.0167
         : individual accs = ['0.828731', '0.841304', '0.833129', '0.838680', '0.828893', '0.838815', '0.841164', '0.842722', '0.849439', '0.844751', '0.831764', '0.835202', '0.833618', '0.833929', '0.844028', '0.841152', '0.835300', '0.833851', '0.835211', '0.833091']
         : correct/total = [(3421, 4128), (3536, 4203), (3400, 4081), (3634, 4333), (3391, 4091), (3596, 4287), (3527, 4193), (3665, 4349), (3560, 4191), (3613, 4277), (3446, 4143), (3502, 4193), (3412, 4093), (3500, 4197), (3420, 4052), (3389, 4029), (3469, 4153), (3488, 4183), (3411, 4084), (3439, 4128)]
         : compromised: 0.8370, honest: 0.8374
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...
Round 010: test acc mean=0.8438 ± 0.0054 | min=0.8322 max=0.8511
         : test loss mean=0.4784 ± 0.0184
         : individual accs = ['0.836483', '0.851059', '0.839010', '0.845142', '0.835493', '0.842081', '0.847603', '0.846631', '0.848723', '0.846388', '0.832247', '0.841164', '0.841437', '0.847987', '0.847976', '0.848349', '0.843968', '0.850586', '0.847209', '0.835756']
         : correct/total = [(3453, 4128), (3577, 4203), (3424, 4081), (3662, 4333), (3418, 4091), (3610, 4287), (3554, 4193), (3682, 4349), (3557, 4191), (3620, 4277), (3448, 4143), (3527, 4193), (3444, 4093), (3559, 4197), (3436, 4052), (3418, 4029), (3505, 4153), (3558, 4183), (3460, 4084), (3450, 4128)]
         : compromised: 0.8462, honest: 0.8421
         : sketchguard stats = ['Node 0: acc_rate=0.562', 'Node 1: acc_rate=0.727', 'Node 2: acc_rate=0.500']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: sketchguard
Attack: directed_deviation, 40.0% compromised
Final accuracy - Compromised: 0.8462, Honest: 0.8421
Overall test accuracy: mean=0.8438 ± 0.0054

=== COARSE SUMMARY ===
Node 0: acceptance=0.562
Node 1: acceptance=0.727
Node 2: acceptance=0.500
Node 3: acceptance=0.625
Node 4: acceptance=0.545
Node 5: acceptance=0.533
Node 6: acceptance=0.500
Node 7: acceptance=0.500
Node 8: acceptance=0.500
Node 9: acceptance=0.692
Node 10: acceptance=0.556
Node 11: acceptance=0.571
Node 12: acceptance=0.667
Node 13: acceptance=0.692
Node 14: acceptance=0.600
Node 15: acceptance=0.545
Node 16: acceptance=0.538
Node 17: acceptance=0.667
Node 18: acceptance=0.688
Node 19: acceptance=0.500

Performance Summary:
  - Sketching time: 16.205s (97.7%)
  - Filtering time: 0.026s (0.2%)
  - Aggregation time: 0.351s (2.1%)
  - Total time: 16.582s
  - Mean acceptance rate: 0.585

COARSE Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

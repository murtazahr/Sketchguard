Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 99
Attack: Compromised 2/20 nodes: [5, 13]
Attack type: gaussian, lambda: 1.0
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.9
  - Stage 1: Distance-based filtering (select 90% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4138 ± 0.0499 | min=0.2835 max=0.5113
         : test loss mean=3.7063 ± 0.0961
         : individual accs = ['0.403585', '0.425410', '0.421710', '0.339488', '0.420435', '0.511313', '0.363224', '0.367441', '0.463613', '0.450783', '0.435916', '0.406869', '0.424383', '0.430546', '0.428924', '0.354927', '0.467855', '0.425532', '0.283546', '0.449612']
         : correct/total = [(1666, 4128), (1788, 4203), (1721, 4081), (1471, 4333), (1720, 4091), (2192, 4287), (1523, 4193), (1598, 4349), (1943, 4191), (1928, 4277), (1806, 4143), (1706, 4193), (1737, 4093), (1807, 4197), (1738, 4052), (1430, 4029), (1943, 4153), (1780, 4183), (1158, 4084), (1856, 4128)]
         : compromised: 0.4709, honest: 0.4074
         : ubar stats = ['Node 0: s1=0.833, s2=0.200', 'Node 1: s1=0.900, s2=0.333', 'Node 2: s1=0.875, s2=0.143']...
Round 002: test acc mean=0.6540 ± 0.0512 | min=0.5247 max=0.7295
         : test loss mean=3.1778 ± 0.2131
         : individual accs = ['0.705184', '0.661432', '0.579025', '0.696746', '0.674652', '0.645206', '0.607202', '0.702460', '0.640181', '0.664484', '0.677528', '0.524684', '0.580259', '0.663807', '0.729516', '0.688757', '0.669636', '0.599331', '0.716699', '0.652616']
         : correct/total = [(2911, 4128), (2780, 4203), (2363, 4081), (3019, 4333), (2760, 4091), (2766, 4287), (2546, 4193), (3055, 4349), (2683, 4191), (2842, 4277), (2807, 4143), (2200, 4193), (2375, 4093), (2786, 4197), (2956, 4052), (2775, 4029), (2781, 4153), (2507, 4183), (2927, 4084), (2694, 4128)]
         : compromised: 0.6545, honest: 0.6539
         : ubar stats = ['Node 0: s1=0.833, s2=0.550', 'Node 1: s1=0.900, s2=0.556', 'Node 2: s1=0.875, s2=0.143']...
Round 003: test acc mean=0.7001 ± 0.0446 | min=0.6035 max=0.7569
         : test loss mean=2.3942 ± 0.7997
         : individual accs = ['0.662306', '0.725196', '0.682186', '0.741980', '0.724517', '0.603452', '0.681135', '0.686595', '0.755190', '0.688333', '0.621048', '0.753876', '0.649157', '0.743388', '0.740622', '0.681310', '0.748134', '0.677026', '0.756856', '0.680233']
         : correct/total = [(2734, 4128), (3048, 4203), (2784, 4081), (3215, 4333), (2964, 4091), (2587, 4287), (2856, 4193), (2986, 4349), (3165, 4191), (2944, 4277), (2573, 4143), (3161, 4193), (2657, 4093), (3120, 4197), (3001, 4052), (2745, 4029), (3107, 4153), (2832, 4183), (3091, 4084), (2808, 4128)]
         : compromised: 0.6734, honest: 0.7031
         : ubar stats = ['Node 0: s1=0.833, s2=0.400', 'Node 1: s1=0.900, s2=0.667', 'Node 2: s1=0.875, s2=0.143']...
Round 004: test acc mean=0.7406 ± 0.0416 | min=0.6297 max=0.7937
         : test loss mean=1.8048 ± 0.5298
         : individual accs = ['0.728440', '0.776112', '0.739280', '0.657512', '0.757761', '0.773968', '0.739804', '0.756726', '0.729420', '0.687164', '0.629737', '0.775340', '0.740288', '0.734096', '0.763327', '0.793745', '0.782326', '0.757112', '0.782566', '0.708091']
         : correct/total = [(3007, 4128), (3262, 4203), (3017, 4081), (2849, 4333), (3100, 4091), (3318, 4287), (3102, 4193), (3291, 4349), (3057, 4191), (2939, 4277), (2609, 4143), (3251, 4193), (3030, 4093), (3081, 4197), (3093, 4052), (3198, 4029), (3249, 4153), (3167, 4183), (3196, 4084), (2923, 4128)]
         : compromised: 0.7540, honest: 0.7392
         : ubar stats = ['Node 0: s1=0.833, s2=0.475', 'Node 1: s1=0.900, s2=0.556', 'Node 2: s1=0.875, s2=0.179']...
Round 005: test acc mean=0.7657 ± 0.0296 | min=0.6902 max=0.8054
         : test loss mean=1.2203 ± 0.4271
         : individual accs = ['0.787548', '0.777778', '0.775300', '0.763674', '0.794182', '0.785631', '0.759599', '0.792596', '0.792890', '0.777648', '0.734251', '0.748152', '0.696066', '0.756016', '0.775666', '0.805411', '0.781122', '0.690175', '0.765181', '0.755572']
         : correct/total = [(3251, 4128), (3269, 4203), (3164, 4081), (3309, 4333), (3249, 4091), (3368, 4287), (3185, 4193), (3447, 4349), (3323, 4191), (3326, 4277), (3042, 4143), (3137, 4193), (2849, 4093), (3173, 4197), (3143, 4052), (3245, 4029), (3244, 4153), (2887, 4183), (3125, 4084), (3119, 4128)]
         : compromised: 0.7708, honest: 0.7652
         : ubar stats = ['Node 0: s1=0.833, s2=0.400', 'Node 1: s1=0.900, s2=0.556', 'Node 2: s1=0.875, s2=0.200']...
Round 006: test acc mean=0.7986 ± 0.0106 | min=0.7745 max=0.8175
         : test loss mean=0.7964 ± 0.1520
         : individual accs = ['0.803779', '0.794670', '0.812791', '0.805216', '0.779516', '0.809890', '0.803005', '0.790067', '0.798139', '0.802899', '0.786869', '0.805628', '0.800880', '0.801763', '0.808490', '0.791015', '0.817481', '0.793928', '0.774486', '0.791182']
         : correct/total = [(3318, 4128), (3340, 4203), (3317, 4081), (3489, 4333), (3189, 4091), (3472, 4287), (3367, 4193), (3436, 4349), (3345, 4191), (3434, 4277), (3260, 4143), (3378, 4193), (3278, 4093), (3365, 4197), (3276, 4052), (3187, 4029), (3395, 4153), (3321, 4183), (3163, 4084), (3266, 4128)]
         : compromised: 0.8058, honest: 0.7978
         : ubar stats = ['Node 0: s1=0.833, s2=0.350', 'Node 1: s1=0.900, s2=0.519', 'Node 2: s1=0.875, s2=0.214']...
Round 007: test acc mean=0.8194 ± 0.0073 | min=0.8061 max=0.8296
         : test loss mean=0.6169 ± 0.0540
         : individual accs = ['0.806686', '0.806091', '0.827248', '0.828756', '0.816182', '0.820387', '0.827093', '0.821108', '0.825340', '0.829553', '0.809558', '0.816361', '0.817493', '0.825590', '0.816634', '0.828245', '0.822297', '0.808750', '0.819050', '0.815649']
         : correct/total = [(3330, 4128), (3388, 4203), (3376, 4081), (3591, 4333), (3339, 4091), (3517, 4287), (3468, 4193), (3571, 4349), (3459, 4191), (3548, 4277), (3354, 4143), (3423, 4193), (3346, 4093), (3465, 4197), (3309, 4052), (3337, 4029), (3415, 4153), (3383, 4183), (3345, 4084), (3367, 4128)]
         : compromised: 0.8230, honest: 0.8190
         : ubar stats = ['Node 0: s1=0.833, s2=0.314', 'Node 1: s1=0.900, s2=0.460', 'Node 2: s1=0.875, s2=0.286']...
Round 008: test acc mean=0.8270 ± 0.0077 | min=0.8077 max=0.8387
         : test loss mean=0.5495 ± 0.0243
         : individual accs = ['0.822917', '0.821556', '0.833619', '0.835218', '0.822537', '0.824119', '0.832817', '0.825017', '0.838702', '0.836100', '0.821868', '0.830670', '0.825312', '0.814153', '0.837364', '0.831968', '0.823020', '0.824050', '0.830558', '0.807655']
         : correct/total = [(3397, 4128), (3453, 4203), (3402, 4081), (3619, 4333), (3365, 4091), (3533, 4287), (3492, 4193), (3588, 4349), (3515, 4191), (3576, 4277), (3405, 4143), (3483, 4193), (3378, 4093), (3417, 4197), (3393, 4052), (3352, 4029), (3418, 4153), (3447, 4183), (3392, 4084), (3334, 4128)]
         : compromised: 0.8191, honest: 0.8278
         : ubar stats = ['Node 0: s1=0.833, s2=0.300', 'Node 1: s1=0.900, s2=0.417', 'Node 2: s1=0.875, s2=0.357']...
Round 009: test acc mean=0.8366 ± 0.0065 | min=0.8243 max=0.8475
         : test loss mean=0.5078 ± 0.0221
         : individual accs = ['0.825581', '0.841304', '0.827983', '0.839834', '0.830115', '0.839981', '0.845218', '0.842033', '0.847530', '0.843816', '0.824282', '0.833771', '0.840704', '0.837265', '0.840819', '0.840903', '0.833133', '0.832656', '0.834721', '0.830426']
         : correct/total = [(3408, 4128), (3536, 4203), (3379, 4081), (3639, 4333), (3396, 4091), (3601, 4287), (3544, 4193), (3662, 4349), (3552, 4191), (3609, 4277), (3415, 4143), (3496, 4193), (3441, 4093), (3514, 4197), (3407, 4052), (3388, 4029), (3460, 4153), (3483, 4183), (3409, 4084), (3428, 4128)]
         : compromised: 0.8386, honest: 0.8364
         : ubar stats = ['Node 0: s1=0.833, s2=0.289', 'Node 1: s1=0.900, s2=0.457', 'Node 2: s1=0.875, s2=0.333']...
Round 010: test acc mean=0.8408 ± 0.0057 | min=0.8277 max=0.8497
         : test loss mean=0.4908 ± 0.0187
         : individual accs = ['0.828973', '0.841066', '0.827738', '0.846065', '0.836959', '0.843480', '0.845457', '0.846172', '0.845622', '0.839373', '0.834902', '0.840687', '0.837527', '0.844174', '0.844274', '0.843634', '0.837948', '0.846283', '0.849657', '0.835271']
         : correct/total = [(3422, 4128), (3535, 4203), (3378, 4081), (3666, 4333), (3424, 4091), (3616, 4287), (3545, 4193), (3680, 4349), (3544, 4191), (3590, 4277), (3459, 4143), (3525, 4193), (3428, 4093), (3543, 4197), (3421, 4052), (3399, 4029), (3480, 4153), (3540, 4183), (3470, 4084), (3448, 4128)]
         : compromised: 0.8438, honest: 0.8404
         : ubar stats = ['Node 0: s1=0.833, s2=0.270', 'Node 1: s1=0.900, s2=0.422', 'Node 2: s1=0.875, s2=0.314']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: ubar
Attack: gaussian, 10.0% compromised
Final accuracy - Compromised: 0.8438, Honest: 0.8404
Overall test accuracy: mean=0.8408 ± 0.0057

=== UBAR SUMMARY ===
Node 0: stage1=0.833, stage2=0.270, overall=0.225
Node 1: stage1=0.900, stage2=0.422, overall=0.380
Node 2: stage1=0.875, stage2=0.314, overall=0.275
Node 3: stage1=0.857, stage2=0.400, overall=0.343
Node 4: stage1=0.889, stage2=0.300, overall=0.267
Node 5: stage1=0.900, stage2=0.267, overall=0.240
Node 6: stage1=0.833, stage2=0.380, overall=0.317
Node 7: stage1=0.818, stage2=0.444, overall=0.364
Node 8: stage1=0.857, stage2=0.350, overall=0.300
Node 9: stage1=0.818, stage2=0.322, overall=0.264
Node 10: stage1=0.875, stage2=0.357, overall=0.312
Node 11: stage1=0.833, stage2=0.200, overall=0.167
Node 12: stage1=0.833, stage2=0.290, overall=0.242
Node 13: stage1=0.889, stage2=0.412, overall=0.367
Node 14: stage1=0.857, stage2=0.367, overall=0.314
Node 15: stage1=0.889, stage2=0.212, overall=0.189
Node 16: stage1=0.857, stage2=0.517, overall=0.443
Node 17: stage1=0.875, stage2=0.400, overall=0.350
Node 18: stage1=0.833, stage2=0.220, overall=0.183
Node 19: stage1=0.900, stage2=0.544, overall=0.490

Performance Summary:
  - Distance computation time: 0.917s (1.0%)
  - Loss computation time: 90.017s (98.8%)
  - Aggregation time: 0.199s (0.2%)
  - Total time: 91.133s
  - Mean Stage 1 acceptance rate: 0.861
  - Mean Stage 2 acceptance rate: 0.349
  - Overall acceptance rate: 0.301

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.9
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 90% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

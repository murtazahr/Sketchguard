Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 1.0
  - Stage 1: Distance-based filtering (select 100% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4624 ± 0.0513 | min=0.3178 max=0.5468
         : test loss mean=3.7491 ± 0.0259
         : individual accs = ['0.317829', '0.444920', '0.504533', '0.440803', '0.462967', '0.546769', '0.352015', '0.452978', '0.530184', '0.474398', '0.479604', '0.465061', '0.464452', '0.458184', '0.496545', '0.431869', '0.478931', '0.504423', '0.485064', '0.457122']
         : correct/total = [(1312, 4128), (1870, 4203), (2059, 4081), (1910, 4333), (1894, 4091), (2344, 4287), (1476, 4193), (1970, 4349), (2222, 4191), (2029, 4277), (1987, 4143), (1950, 4193), (1901, 4093), (1923, 4197), (2012, 4052), (1740, 4029), (1989, 4153), (2110, 4183), (1981, 4084), (1887, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.053', 'Node 1: s1=1.000, s2=0.211', 'Node 2: s1=1.000, s2=0.316']...
Round 002: test acc mean=0.6561 ± 0.0318 | min=0.5910 max=0.7071
         : test loss mean=3.3609 ± 0.1450
         : individual accs = ['0.628634', '0.638116', '0.601078', '0.687745', '0.637008', '0.658269', '0.590985', '0.654633', '0.663565', '0.625906', '0.690804', '0.696399', '0.659174', '0.643793', '0.691510', '0.707123', '0.651336', '0.686589', '0.684133', '0.625969']
         : correct/total = [(2595, 4128), (2682, 4203), (2453, 4081), (2980, 4333), (2606, 4091), (2822, 4287), (2478, 4193), (2847, 4349), (2781, 4191), (2677, 4277), (2862, 4143), (2920, 4193), (2698, 4093), (2702, 4197), (2802, 4052), (2849, 4029), (2705, 4153), (2872, 4183), (2794, 4084), (2584, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.053', 'Node 1: s1=1.000, s2=0.158', 'Node 2: s1=1.000, s2=0.211']...
Round 003: test acc mean=0.6758 ± 0.0401 | min=0.6042 max=0.7500
         : test loss mean=2.9726 ± 0.3374
         : individual accs = ['0.750000', '0.706400', '0.641509', '0.718440', '0.722562', '0.625612', '0.682566', '0.639227', '0.666428', '0.705869', '0.604152', '0.664679', '0.685561', '0.688349', '0.732231', '0.645818', '0.661931', '0.712407', '0.645201', '0.616279']
         : correct/total = [(3096, 4128), (2969, 4203), (2618, 4081), (3113, 4333), (2956, 4091), (2682, 4287), (2862, 4193), (2780, 4349), (2793, 4191), (3019, 4277), (2503, 4143), (2787, 4193), (2806, 4093), (2889, 4197), (2967, 4052), (2602, 4029), (2749, 4153), (2980, 4183), (2635, 4084), (2544, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.228', 'Node 1: s1=1.000, s2=0.368', 'Node 2: s1=1.000, s2=0.193']...
Round 004: test acc mean=0.6948 ± 0.0339 | min=0.6194 max=0.7426
         : test loss mean=2.5940 ± 0.1612
         : individual accs = ['0.696463', '0.740899', '0.678020', '0.715440', '0.742606', '0.707721', '0.732888', '0.716946', '0.675734', '0.679916', '0.619358', '0.724779', '0.660884', '0.725518', '0.636476', '0.706627', '0.692993', '0.694956', '0.706660', '0.641957']
         : correct/total = [(2875, 4128), (3114, 4203), (2767, 4081), (3100, 4333), (3038, 4091), (3034, 4287), (3073, 4193), (3118, 4349), (2832, 4191), (2908, 4277), (2566, 4143), (3039, 4193), (2705, 4093), (3045, 4197), (2579, 4052), (2847, 4029), (2878, 4153), (2907, 4183), (2886, 4084), (2650, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.329', 'Node 1: s1=1.000, s2=0.487', 'Node 2: s1=1.000, s2=0.211']...
Round 005: test acc mean=0.6968 ± 0.0372 | min=0.6180 max=0.7530
         : test loss mean=1.8684 ± 0.2317
         : individual accs = ['0.726260', '0.695931', '0.719677', '0.739672', '0.719140', '0.713086', '0.712378', '0.661991', '0.709616', '0.723170', '0.653874', '0.709516', '0.625214', '0.709554', '0.752962', '0.708613', '0.667229', '0.643318', '0.726494', '0.617975']
         : correct/total = [(2998, 4128), (2925, 4203), (2937, 4081), (3205, 4333), (2942, 4091), (3057, 4287), (2987, 4193), (2879, 4349), (2974, 4191), (3093, 4277), (2709, 4143), (2975, 4193), (2559, 4093), (2978, 4197), (3051, 4052), (2855, 4029), (2771, 4153), (2691, 4183), (2967, 4084), (2551, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.295', 'Node 1: s1=1.000, s2=0.463', 'Node 2: s1=1.000, s2=0.232']...
Round 006: test acc mean=0.7653 ± 0.0160 | min=0.7371 max=0.7977
         : test loss mean=1.0478 ± 0.1678
         : individual accs = ['0.774709', '0.751844', '0.760353', '0.766213', '0.750672', '0.756473', '0.780825', '0.775351', '0.757814', '0.786766', '0.743905', '0.763654', '0.737112', '0.762211', '0.757404', '0.797717', '0.772694', '0.749701', '0.762733', '0.796996']
         : correct/total = [(3198, 4128), (3160, 4203), (3103, 4081), (3320, 4333), (3071, 4091), (3243, 4287), (3274, 4193), (3372, 4349), (3176, 4191), (3365, 4277), (3082, 4143), (3202, 4193), (3017, 4093), (3199, 4197), (3069, 4052), (3214, 4029), (3209, 4153), (3136, 4183), (3115, 4084), (3290, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.254', 'Node 1: s1=1.000, s2=0.544', 'Node 2: s1=1.000, s2=0.202']...
Round 007: test acc mean=0.8041 ± 0.0083 | min=0.7835 max=0.8173
         : test loss mean=0.7194 ± 0.0567
         : individual accs = ['0.799419', '0.817273', '0.795883', '0.806601', '0.802493', '0.812923', '0.797520', '0.800874', '0.806251', '0.816460', '0.802076', '0.814930', '0.783533', '0.800572', '0.804047', '0.808637', '0.813869', '0.795840', '0.796278', '0.807413']
         : correct/total = [(3300, 4128), (3435, 4203), (3248, 4081), (3495, 4333), (3283, 4091), (3485, 4287), (3344, 4193), (3483, 4349), (3379, 4191), (3492, 4277), (3323, 4143), (3417, 4193), (3207, 4093), (3360, 4197), (3258, 4052), (3258, 4029), (3380, 4153), (3329, 4183), (3252, 4084), (3333, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.241', 'Node 1: s1=1.000, s2=0.489', 'Node 2: s1=1.000, s2=0.316']...
Round 008: test acc mean=0.8192 ± 0.0093 | min=0.7856 max=0.8297
         : test loss mean=0.5818 ± 0.0232
         : individual accs = ['0.812258', '0.822032', '0.814996', '0.825987', '0.816915', '0.818288', '0.824231', '0.826167', '0.823431', '0.819733', '0.811248', '0.821846', '0.812607', '0.821539', '0.829714', '0.820055', '0.825427', '0.822854', '0.828599', '0.785610']
         : correct/total = [(3353, 4128), (3455, 4203), (3326, 4081), (3579, 4333), (3342, 4091), (3508, 4287), (3456, 4193), (3593, 4349), (3451, 4191), (3506, 4277), (3361, 4143), (3446, 4193), (3326, 4093), (3448, 4197), (3362, 4052), (3304, 4029), (3428, 4153), (3442, 4183), (3384, 4084), (3243, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.289', 'Node 1: s1=1.000, s2=0.434', 'Node 2: s1=1.000, s2=0.309']...
Round 009: test acc mean=0.8333 ± 0.0058 | min=0.8217 max=0.8468
         : test loss mean=0.5204 ± 0.0169
         : individual accs = ['0.821705', '0.833690', '0.831659', '0.834064', '0.825959', '0.835783', '0.833294', '0.836284', '0.846815', '0.844283', '0.826213', '0.829478', '0.834351', '0.837265', '0.838105', '0.836436', '0.831688', '0.830743', '0.831293', '0.827277']
         : correct/total = [(3392, 4128), (3504, 4203), (3394, 4081), (3614, 4333), (3379, 4091), (3583, 4287), (3494, 4193), (3637, 4349), (3549, 4191), (3611, 4277), (3423, 4143), (3478, 4193), (3415, 4093), (3514, 4197), (3396, 4052), (3370, 4029), (3454, 4153), (3475, 4183), (3395, 4084), (3415, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.263', 'Node 1: s1=1.000, s2=0.392', 'Node 2: s1=1.000, s2=0.287']...
Round 010: test acc mean=0.8388 ± 0.0061 | min=0.8265 max=0.8487
         : test loss mean=0.4948 ± 0.0211
         : individual accs = ['0.831395', '0.848680', '0.831169', '0.844680', '0.829870', '0.840914', '0.842595', '0.845942', '0.844906', '0.833996', '0.826454', '0.835202', '0.842658', '0.841553', '0.836130', '0.841152', '0.838430', '0.844848', '0.841822', '0.833091']
         : correct/total = [(3432, 4128), (3567, 4203), (3392, 4081), (3660, 4333), (3395, 4091), (3605, 4287), (3533, 4193), (3679, 4349), (3541, 4191), (3567, 4277), (3424, 4143), (3502, 4193), (3449, 4093), (3532, 4197), (3388, 4052), (3389, 4029), (3482, 4153), (3534, 4183), (3438, 4084), (3439, 4128)]
         : ubar stats = ['Node 0: s1=1.000, s2=0.247', 'Node 1: s1=1.000, s2=0.368', 'Node 2: s1=1.000, s2=0.263']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: ubar
Overall test accuracy: mean=0.8388 ± 0.0061

=== UBAR SUMMARY ===
Node 0: stage1=1.000, stage2=0.247, overall=0.247
Node 1: stage1=1.000, stage2=0.368, overall=0.368
Node 2: stage1=1.000, stage2=0.263, overall=0.263
Node 3: stage1=1.000, stage2=0.426, overall=0.426
Node 4: stage1=1.000, stage2=0.247, overall=0.247
Node 5: stage1=1.000, stage2=0.284, overall=0.284
Node 6: stage1=1.000, stage2=0.174, overall=0.174
Node 7: stage1=1.000, stage2=0.279, overall=0.279
Node 8: stage1=1.000, stage2=0.321, overall=0.321
Node 9: stage1=1.000, stage2=0.258, overall=0.258
Node 10: stage1=1.000, stage2=0.300, overall=0.300
Node 11: stage1=1.000, stage2=0.363, overall=0.363
Node 12: stage1=1.000, stage2=0.258, overall=0.258
Node 13: stage1=1.000, stage2=0.421, overall=0.421
Node 14: stage1=1.000, stage2=0.316, overall=0.316
Node 15: stage1=1.000, stage2=0.179, overall=0.179
Node 16: stage1=1.000, stage2=0.474, overall=0.474
Node 17: stage1=1.000, stage2=0.516, overall=0.516
Node 18: stage1=1.000, stage2=0.453, overall=0.453
Node 19: stage1=1.000, stage2=0.211, overall=0.211

Performance Summary:
  - Distance computation time: 1.687s (1.9%)
  - Loss computation time: 86.282s (97.8%)
  - Aggregation time: 0.257s (0.3%)
  - Total time: 88.226s
  - Mean Stage 1 acceptance rate: 1.000
  - Mean Stage 2 acceptance rate: 0.318
  - Overall acceptance rate: 0.318

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 1.0
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 100% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

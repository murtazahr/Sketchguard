Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 99
Attack: Compromised 12/20 nodes: [1, 2, 3, 5, 8, 11, 12, 13, 14, 15, 17, 18]
Attack type: directed_deviation, lambda: 1.0
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.4
  - Stage 1: Distance-based filtering (select 40% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.3745 ± 0.0764 | min=0.1639 max=0.4878
         : test loss mean=3.6940 ± 0.1188
         : individual accs = ['0.427568', '0.416607', '0.352120', '0.351719', '0.403569', '0.487754', '0.381827', '0.163946', '0.413982', '0.356792', '0.288197', '0.481517', '0.391400', '0.402669', '0.470138', '0.349218', '0.377558', '0.275400', '0.276934', '0.421754']
         : correct/total = [(1765, 4128), (1751, 4203), (1437, 4081), (1524, 4333), (1651, 4091), (2091, 4287), (1601, 4193), (713, 4349), (1735, 4191), (1526, 4277), (1194, 4143), (2019, 4193), (1602, 4093), (1690, 4197), (1905, 4052), (1407, 4029), (1568, 4153), (1152, 4183), (1131, 4084), (1741, 4128)]
         : compromised: 0.3891, honest: 0.3527
         : ubar stats = ['Node 0: s1=0.333, s2=0.250', 'Node 1: s1=0.400, s2=0.750', 'Node 2: s1=0.375, s2=0.333']...
Round 002: test acc mean=0.6586 ± 0.0460 | min=0.5357 max=0.7161
         : test loss mean=2.4505 ± 0.8693
         : individual accs = ['0.672965', '0.662146', '0.696153', '0.661205', '0.701296', '0.687427', '0.535655', '0.640147', '0.665712', '0.711246', '0.716148', '0.646554', '0.625947', '0.664284', '0.705084', '0.604368', '0.650373', '0.670810', '0.690744', '0.564680']
         : correct/total = [(2778, 4128), (2783, 4203), (2841, 4081), (2865, 4333), (2869, 4091), (2947, 4287), (2246, 4193), (2784, 4349), (2790, 4191), (3042, 4277), (2967, 4143), (2711, 4193), (2562, 4093), (2788, 4197), (2857, 4052), (2435, 4029), (2701, 4153), (2806, 4183), (2821, 4084), (2331, 4128)]
         : compromised: 0.6650, honest: 0.6491
         : ubar stats = ['Node 0: s1=0.333, s2=0.250', 'Node 1: s1=0.400, s2=0.625', 'Node 2: s1=0.375, s2=0.333']...
Round 003: test acc mean=0.7229 ± 0.0482 | min=0.6113 max=0.7808
         : test loss mean=1.7529 ± 0.7264
         : individual accs = ['0.780766', '0.639781', '0.721392', '0.770829', '0.776827', '0.642874', '0.718340', '0.767533', '0.611310', '0.763152', '0.731113', '0.751252', '0.701686', '0.670479', '0.706811', '0.758997', '0.754154', '0.759503', '0.700784', '0.730136']
         : correct/total = [(3223, 4128), (2689, 4203), (2944, 4081), (3340, 4333), (3178, 4091), (2756, 4287), (3012, 4193), (3338, 4349), (2562, 4191), (3264, 4277), (3029, 4143), (3150, 4193), (2872, 4093), (2814, 4197), (2864, 4052), (3058, 4029), (3132, 4153), (3177, 4183), (2862, 4084), (3014, 4128)]
         : compromised: 0.7030, honest: 0.7528
         : ubar stats = ['Node 0: s1=0.333, s2=0.333', 'Node 1: s1=0.400, s2=0.667', 'Node 2: s1=0.375, s2=0.333']...
Round 004: test acc mean=0.7844 ± 0.0205 | min=0.7282 max=0.8137
         : test loss mean=0.9504 ± 0.3535
         : individual accs = ['0.792151', '0.760171', '0.792943', '0.797831', '0.789782', '0.728248', '0.800620', '0.798115', '0.786447', '0.813654', '0.762974', '0.786311', '0.750550', '0.772457', '0.780355', '0.811119', '0.804719', '0.788190', '0.791871', '0.779312']
         : correct/total = [(3270, 4128), (3195, 4203), (3236, 4081), (3457, 4333), (3231, 4091), (3122, 4287), (3357, 4193), (3471, 4349), (3296, 4191), (3480, 4277), (3161, 4143), (3297, 4193), (3072, 4093), (3242, 4197), (3162, 4052), (3268, 4029), (3342, 4153), (3297, 4183), (3234, 4084), (3217, 4128)]
         : compromised: 0.7789, honest: 0.7927
         : ubar stats = ['Node 0: s1=0.333, s2=0.312', 'Node 1: s1=0.400, s2=0.562', 'Node 2: s1=0.375, s2=0.333']...
Round 005: test acc mean=0.8104 ± 0.0081 | min=0.7954 max=0.8231
         : test loss mean=0.6541 ± 0.1120
         : individual accs = ['0.812016', '0.816560', '0.823083', '0.813755', '0.810560', '0.801026', '0.814691', '0.811221', '0.809353', '0.822539', '0.796766', '0.795373', '0.796237', '0.800334', '0.816140', '0.816580', '0.817000', '0.813531', '0.812439', '0.809109']
         : correct/total = [(3352, 4128), (3432, 4203), (3359, 4081), (3526, 4333), (3316, 4091), (3434, 4287), (3416, 4193), (3528, 4349), (3392, 4191), (3518, 4277), (3301, 4143), (3335, 4193), (3259, 4093), (3359, 4197), (3307, 4052), (3290, 4029), (3393, 4153), (3403, 4183), (3318, 4084), (3340, 4128)]
         : compromised: 0.8095, honest: 0.8117
         : ubar stats = ['Node 0: s1=0.333, s2=0.300', 'Node 1: s1=0.400, s2=0.600', 'Node 2: s1=0.375, s2=0.333']...
Round 006: test acc mean=0.8236 ± 0.0087 | min=0.8094 max=0.8384
         : test loss mean=0.6135 ± 0.1201
         : individual accs = ['0.825339', '0.836307', '0.826023', '0.826910', '0.822537', '0.809657', '0.814453', '0.825247', '0.809353', '0.838438', '0.816075', '0.818746', '0.810897', '0.829402', '0.833416', '0.834947', '0.831929', '0.825006', '0.820519', '0.815891']
         : correct/total = [(3407, 4128), (3515, 4203), (3371, 4081), (3583, 4333), (3365, 4091), (3471, 4287), (3415, 4193), (3589, 4349), (3392, 4191), (3586, 4277), (3381, 4143), (3433, 4193), (3319, 4093), (3481, 4197), (3377, 4052), (3364, 4029), (3455, 4153), (3451, 4183), (3351, 4084), (3368, 4128)]
         : compromised: 0.8234, honest: 0.8237
         : ubar stats = ['Node 0: s1=0.333, s2=0.375', 'Node 1: s1=0.400, s2=0.583', 'Node 2: s1=0.375, s2=0.333']...
Round 007: test acc mean=0.8323 ± 0.0081 | min=0.8081 max=0.8468
         : test loss mean=0.5258 ± 0.0343
         : individual accs = ['0.827035', '0.846776', '0.840725', '0.835449', '0.828404', '0.832517', '0.832817', '0.830766', '0.831305', '0.841478', '0.808110', '0.829478', '0.833374', '0.834167', '0.840819', '0.828742', '0.841801', '0.825006', '0.833741', '0.823886']
         : correct/total = [(3414, 4128), (3559, 4203), (3431, 4081), (3620, 4333), (3389, 4091), (3569, 4287), (3492, 4193), (3613, 4349), (3484, 4191), (3599, 4277), (3348, 4143), (3478, 4193), (3411, 4093), (3501, 4197), (3407, 4052), (3339, 4029), (3496, 4153), (3451, 4183), (3405, 4084), (3401, 4128)]
         : compromised: 0.8343, honest: 0.8293
         : ubar stats = ['Node 0: s1=0.333, s2=0.357', 'Node 1: s1=0.400, s2=0.536', 'Node 2: s1=0.375, s2=0.333']...
Round 008: test acc mean=0.8355 ± 0.0093 | min=0.8101 max=0.8487
         : test loss mean=0.5023 ± 0.0307
         : individual accs = ['0.830669', '0.843445', '0.838765', '0.835680', '0.839404', '0.836249', '0.841164', '0.837664', '0.829158', '0.844283', '0.817524', '0.839733', '0.833374', '0.842268', '0.848717', '0.841648', '0.834577', '0.822615', '0.843291', '0.810078']
         : correct/total = [(3429, 4128), (3545, 4203), (3423, 4081), (3621, 4333), (3434, 4091), (3585, 4287), (3527, 4193), (3643, 4349), (3475, 4191), (3611, 4277), (3387, 4143), (3521, 4193), (3411, 4093), (3535, 4197), (3439, 4052), (3391, 4029), (3466, 4153), (3441, 4183), (3444, 4084), (3344, 4128)]
         : compromised: 0.8379, honest: 0.8319
         : ubar stats = ['Node 0: s1=0.333, s2=0.344', 'Node 1: s1=0.400, s2=0.531', 'Node 2: s1=0.375, s2=0.333']...
Round 009: test acc mean=0.8408 ± 0.0066 | min=0.8272 max=0.8526
         : test loss mean=0.4864 ± 0.0244
         : individual accs = ['0.840116', '0.849155', '0.841460', '0.837988', '0.828159', '0.845113', '0.852611', '0.844562', '0.848246', '0.844751', '0.827178', '0.838779', '0.839726', '0.844174', '0.847236', '0.843882', '0.833614', '0.834090', '0.838883', '0.835756']
         : correct/total = [(3468, 4128), (3569, 4203), (3434, 4081), (3631, 4333), (3388, 4091), (3623, 4287), (3575, 4193), (3673, 4349), (3555, 4191), (3613, 4277), (3427, 4143), (3517, 4193), (3437, 4093), (3543, 4197), (3433, 4052), (3400, 4029), (3462, 4153), (3489, 4183), (3426, 4084), (3450, 4128)]
         : compromised: 0.8424, honest: 0.8383
         : ubar stats = ['Node 0: s1=0.333, s2=0.333', 'Node 1: s1=0.400, s2=0.500', 'Node 2: s1=0.375, s2=0.333']...
Round 010: test acc mean=0.8467 ± 0.0064 | min=0.8343 max=0.8580
         : test loss mean=0.4655 ± 0.0218
         : individual accs = ['0.841085', '0.857959', '0.849792', '0.838449', '0.834270', '0.850245', '0.857143', '0.850080', '0.852064', '0.855506', '0.837075', '0.846411', '0.847545', '0.849655', '0.848470', '0.846364', '0.845895', '0.845804', '0.840842', '0.839874']
         : correct/total = [(3472, 4128), (3606, 4203), (3468, 4081), (3633, 4333), (3413, 4091), (3645, 4287), (3594, 4193), (3697, 4349), (3571, 4191), (3659, 4277), (3468, 4143), (3549, 4193), (3469, 4093), (3566, 4197), (3438, 4052), (3410, 4029), (3513, 4153), (3538, 4183), (3434, 4084), (3467, 4128)]
         : compromised: 0.8478, honest: 0.8451
         : ubar stats = ['Node 0: s1=0.333, s2=0.325', 'Node 1: s1=0.400, s2=0.475', 'Node 2: s1=0.375, s2=0.333']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: ubar
Attack: directed_deviation, 60.0% compromised
Final accuracy - Compromised: 0.8478, Honest: 0.8451
Overall test accuracy: mean=0.8467 ± 0.0064

=== UBAR SUMMARY ===
Node 0: stage1=0.333, stage2=0.325, overall=0.108
Node 1: stage1=0.400, stage2=0.475, overall=0.190
Node 2: stage1=0.375, stage2=0.333, overall=0.125
Node 3: stage1=0.286, stage2=0.700, overall=0.200
Node 4: stage1=0.333, stage2=0.433, overall=0.144
Node 5: stage1=0.400, stage2=0.475, overall=0.190
Node 6: stage1=0.333, stage2=0.275, overall=0.092
Node 7: stage1=0.364, stage2=0.300, overall=0.109
Node 8: stage1=0.286, stage2=0.600, overall=0.171
Node 9: stage1=0.364, stage2=0.325, overall=0.118
Node 10: stage1=0.375, stage2=0.367, overall=0.138
Node 11: stage1=0.333, stage2=0.425, overall=0.142
Node 12: stage1=0.333, stage2=0.525, overall=0.175
Node 13: stage1=0.333, stage2=0.533, overall=0.178
Node 14: stage1=0.357, stage2=0.440, overall=0.157
Node 15: stage1=0.333, stage2=0.333, overall=0.111
Node 16: stage1=0.286, stage2=0.550, overall=0.157
Node 17: stage1=0.375, stage2=0.400, overall=0.150
Node 18: stage1=0.333, stage2=0.500, overall=0.167
Node 19: stage1=0.400, stage2=0.425, overall=0.170

Performance Summary:
  - Distance computation time: 0.834s (1.0%)
  - Loss computation time: 84.129s (98.9%)
  - Aggregation time: 0.115s (0.1%)
  - Total time: 85.079s
  - Mean Stage 1 acceptance rate: 0.347
  - Mean Stage 2 acceptance rate: 0.437
  - Overall acceptance rate: 0.151

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.4
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 40% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: fully, nodes: 20, edges: 190
Attack: Compromised 6/20 nodes: [5, 12, 13, 14, 17, 18]
Attack type: gaussian, lambda: 1.0
COARSE Node 0:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 1:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 2:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 3:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 4:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 5:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 6:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 7:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 8:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 9:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 10:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 11:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 12:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 13:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 14:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 15:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 16:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 17:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 18:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE Node 19:
  Model dim: 6,603,710 → Sketch size: 1000
  Compression ratio: 6603.7x
  Using model parameters for aggregation, sketches for filtering
COARSE ALGORITHM (Sketch-based Filtering + State Aggregation)
  - Model dimension: 6,603,710 parameters
  - Sketch size: 1000
  - Compression ratio: 6603.7x
  - Complexity: O(d + N×k) = O(6,603,710 + 20×1000)
  - Theoretical speedup vs BALANCE: 19.9x
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.5051 ± 0.0332 | min=0.4496 max=0.5581
         : test loss mean=3.7426 ± 0.0233
         : individual accs = ['0.558140', '0.504640', '0.524381', '0.511193', '0.482278', '0.553301', '0.492010', '0.507013', '0.538296', '0.460837', '0.474535', '0.546148', '0.471781', '0.469383', '0.508391', '0.536361', '0.462798', '0.548171', '0.503183', '0.449612']
         : correct/total = [(2304, 4128), (2121, 4203), (2140, 4081), (2215, 4333), (1973, 4091), (2372, 4287), (2063, 4193), (2205, 4349), (2256, 4191), (1971, 4277), (1966, 4143), (2290, 4193), (1931, 4093), (1970, 4197), (2060, 4052), (2161, 4029), (1922, 4153), (2293, 4183), (2055, 4084), (1856, 4128)]
         : compromised: 0.5090, honest: 0.5034
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 002: test acc mean=0.6777 ± 0.0202 | min=0.6179 max=0.7026
         : test loss mean=3.4313 ± 0.0570
         : individual accs = ['0.684351', '0.689270', '0.668219', '0.699515', '0.683696', '0.689993', '0.617935', '0.688204', '0.666667', '0.702595', '0.664736', '0.696876', '0.688248', '0.663331', '0.702122', '0.685282', '0.649892', '0.657662', '0.685602', '0.669089']
         : correct/total = [(2825, 4128), (2897, 4203), (2727, 4081), (3031, 4333), (2797, 4091), (2958, 4287), (2591, 4193), (2993, 4349), (2794, 4191), (3005, 4277), (2754, 4143), (2922, 4193), (2817, 4093), (2784, 4197), (2845, 4052), (2761, 4029), (2699, 4153), (2751, 4183), (2800, 4084), (2762, 4128)]
         : compromised: 0.6812, honest: 0.6762
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 003: test acc mean=0.6957 ± 0.0230 | min=0.6300 max=0.7311
         : test loss mean=3.1307 ± 0.1162
         : individual accs = ['0.725533', '0.701404', '0.681696', '0.731133', '0.682963', '0.630044', '0.706654', '0.715107', '0.719637', '0.675473', '0.684287', '0.714047', '0.714879', '0.684298', '0.715696', '0.680318', '0.689381', '0.674157', '0.685602', '0.702519']
         : correct/total = [(2995, 4128), (2948, 4203), (2782, 4081), (3168, 4333), (2794, 4091), (2701, 4287), (2963, 4193), (3110, 4349), (3016, 4191), (2889, 4277), (2835, 4143), (2994, 4193), (2926, 4093), (2872, 4197), (2900, 4052), (2741, 4029), (2863, 4153), (2820, 4183), (2800, 4084), (2900, 4128)]
         : compromised: 0.6841, honest: 0.7007
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 004: test acc mean=0.6700 ± 0.0382 | min=0.5781 max=0.7221
         : test loss mean=2.5844 ± 0.1686
         : individual accs = ['0.679748', '0.691887', '0.643470', '0.693976', '0.722073', '0.611383', '0.707369', '0.699931', '0.718683', '0.662614', '0.622979', '0.700930', '0.578060', '0.678103', '0.681392', '0.679077', '0.692030', '0.609610', '0.649853', '0.676599']
         : correct/total = [(2806, 4128), (2908, 4203), (2626, 4081), (3007, 4333), (2954, 4091), (2621, 4287), (2966, 4193), (3044, 4349), (3012, 4191), (2834, 4277), (2581, 4143), (2939, 4193), (2366, 4093), (2846, 4197), (2761, 4052), (2736, 4029), (2874, 4153), (2550, 4183), (2654, 4084), (2793, 4128)]
         : compromised: 0.6347, honest: 0.6851
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 005: test acc mean=0.6523 ± 0.0368 | min=0.5625 max=0.7115
         : test loss mean=1.8651 ± 0.1575
         : individual accs = ['0.676357', '0.648346', '0.614800', '0.655204', '0.672452', '0.626079', '0.676365', '0.683146', '0.693152', '0.682488', '0.636737', '0.687813', '0.595162', '0.615678', '0.620928', '0.638868', '0.711534', '0.562515', '0.669442', '0.678537']
         : correct/total = [(2792, 4128), (2725, 4203), (2509, 4081), (2839, 4333), (2751, 4091), (2684, 4287), (2836, 4193), (2971, 4349), (2905, 4191), (2919, 4277), (2638, 4143), (2884, 4193), (2436, 4093), (2584, 4197), (2516, 4052), (2574, 4029), (2955, 4153), (2353, 4183), (2734, 4084), (2801, 4128)]
         : compromised: 0.6150, honest: 0.6683
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 006: test acc mean=0.7469 ± 0.0139 | min=0.7161 max=0.7635
         : test loss mean=1.0696 ± 0.0724
         : individual accs = ['0.722868', '0.744944', '0.753002', '0.755135', '0.754339', '0.716118', '0.760315', '0.757645', '0.761155', '0.753098', '0.758870', '0.757930', '0.725629', '0.745533', '0.746792', '0.741127', '0.763544', '0.723882', '0.741675', '0.754845']
         : correct/total = [(2984, 4128), (3131, 4203), (3073, 4081), (3272, 4333), (3086, 4091), (3070, 4287), (3188, 4193), (3295, 4349), (3190, 4191), (3221, 4277), (3144, 4143), (3178, 4193), (2970, 4093), (3129, 4197), (3026, 4052), (2986, 4029), (3171, 4153), (3028, 4183), (3029, 4084), (3116, 4128)]
         : compromised: 0.7333, honest: 0.7528
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 007: test acc mean=0.8060 ± 0.0074 | min=0.7906 max=0.8175
         : test loss mean=0.6626 ± 0.0282
         : individual accs = ['0.798934', '0.811325', '0.795148', '0.810755', '0.795405', '0.807558', '0.814930', '0.815130', '0.817466', '0.812953', '0.799421', '0.805151', '0.790618', '0.805575', '0.810464', '0.804170', '0.811702', '0.806837', '0.808521', '0.797238']
         : correct/total = [(3298, 4128), (3410, 4203), (3245, 4081), (3513, 4333), (3254, 4091), (3462, 4287), (3417, 4193), (3545, 4349), (3426, 4191), (3477, 4277), (3312, 4143), (3376, 4193), (3236, 4093), (3381, 4197), (3284, 4052), (3240, 4029), (3371, 4153), (3375, 4183), (3302, 4084), (3291, 4128)]
         : compromised: 0.8049, honest: 0.8064
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 008: test acc mean=0.8245 ± 0.0064 | min=0.8084 max=0.8328
         : test loss mean=0.5499 ± 0.0193
         : individual accs = ['0.814196', '0.827266', '0.821367', '0.832679', '0.819848', '0.832750', '0.828762', '0.829846', '0.830112', '0.826514', '0.819455', '0.829478', '0.818471', '0.826305', '0.831194', '0.827997', '0.817000', '0.824289', '0.824437', '0.808382']
         : correct/total = [(3361, 4128), (3477, 4203), (3352, 4081), (3608, 4333), (3354, 4091), (3570, 4287), (3475, 4193), (3609, 4349), (3479, 4191), (3535, 4277), (3395, 4143), (3478, 4193), (3350, 4093), (3468, 4197), (3368, 4052), (3336, 4029), (3393, 4153), (3448, 4183), (3367, 4084), (3337, 4128)]
         : compromised: 0.8262, honest: 0.8238
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 009: test acc mean=0.8368 ± 0.0054 | min=0.8285 max=0.8490
         : test loss mean=0.5024 ± 0.0185
         : individual accs = ['0.828488', '0.839638', '0.834599', '0.840757', '0.829382', '0.834383', '0.844264', '0.841113', '0.848962', '0.842413', '0.831523', '0.834248', '0.834351', '0.834882', '0.843287', '0.839662', '0.830725', '0.837198', '0.835455', '0.831153']
         : correct/total = [(3420, 4128), (3529, 4203), (3406, 4081), (3643, 4333), (3393, 4091), (3577, 4287), (3540, 4193), (3658, 4349), (3558, 4191), (3603, 4277), (3445, 4143), (3498, 4193), (3415, 4093), (3504, 4197), (3417, 4052), (3383, 4029), (3450, 4153), (3502, 4183), (3412, 4084), (3431, 4128)]
         : compromised: 0.8366, honest: 0.8369
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...
Round 010: test acc mean=0.8435 ± 0.0057 | min=0.8321 max=0.8511
         : test loss mean=0.4798 ± 0.0191
         : individual accs = ['0.834787', '0.851059', '0.840725', '0.847911', '0.832070', '0.842547', '0.846888', '0.848241', '0.847053', '0.847557', '0.833213', '0.836632', '0.840704', '0.848463', '0.846249', '0.848598', '0.845413', '0.847478', '0.847209', '0.837694']
         : correct/total = [(3446, 4128), (3577, 4203), (3431, 4081), (3674, 4333), (3404, 4091), (3612, 4287), (3551, 4193), (3689, 4349), (3550, 4191), (3625, 4277), (3452, 4143), (3508, 4193), (3441, 4093), (3561, 4197), (3429, 4052), (3419, 4029), (3511, 4153), (3545, 4183), (3460, 4084), (3458, 4128)]
         : compromised: 0.8454, honest: 0.8427
         : sketchguard stats = ['Node 0: acc_rate=0.684', 'Node 1: acc_rate=0.684', 'Node 2: acc_rate=0.684']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: fully, Aggregation: sketchguard
Attack: gaussian, 30.0% compromised
Final accuracy - Compromised: 0.8454, Honest: 0.8427
Overall test accuracy: mean=0.8435 ± 0.0057

=== COARSE SUMMARY ===
Node 0: acceptance=0.684
Node 1: acceptance=0.684
Node 2: acceptance=0.684
Node 3: acceptance=0.684
Node 4: acceptance=0.684
Node 5: acceptance=0.737
Node 6: acceptance=0.684
Node 7: acceptance=0.684
Node 8: acceptance=0.684
Node 9: acceptance=0.684
Node 10: acceptance=0.684
Node 11: acceptance=0.684
Node 12: acceptance=0.737
Node 13: acceptance=0.737
Node 14: acceptance=0.737
Node 15: acceptance=0.684
Node 16: acceptance=0.684
Node 17: acceptance=0.737
Node 18: acceptance=0.737
Node 19: acceptance=0.684

Performance Summary:
  - Sketching time: 14.916s (96.7%)
  - Filtering time: 0.031s (0.2%)
  - Aggregation time: 0.486s (3.1%)
  - Total time: 15.433s
  - Mean acceptance rate: 0.700

COARSE Algorithm Properties:
  - Original dimension: 6,603,710
  - Sketch size: 1000
  - Compression ratio: 19.9x
  - Single repetition: No repetitions needed
  - Theoretical complexity: O(d + N×k)
  - Approach: Sketch filtering + state aggregation

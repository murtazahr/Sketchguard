Device: cuda
Seed: 987654321
Looking for images in: /home/student.unimelb.edu.au/mrangwala/Projects/Sketchguard/leaf/data/celeba/data/raw/img_align_celeba
Loading 1 LEAF CelebA train files...
LEAF CelebA train: 9343 users (celebrities), 177457 samples
Looking for images in: /home/student.unimelb.edu.au/mrangwala/Projects/Sketchguard/leaf/data/celeba/data/raw/img_align_celeba
Loading 1 LEAF CelebA test files...
LEAF CelebA test: 9343 users (celebrities), 22831 samples
Found 9343 train users, 9343 test users, 9343 common users
User sample counts range: 31 (max) to 4 (min)
Distributed ALL 9343 users across 20 clients
Users per client: 467 (with 3 clients getting +1 user)
Train partition sizes: [8843, 8998, 8728, 9034, 8866, 8946, 8873, 8776, 8816, 8801, 8913, 8656, 9115, 8921, 8699, 8823, 8912, 8766, 9102, 8869]
Test partition sizes: [1140, 1158, 1127, 1158, 1134, 1145, 1145, 1127, 1136, 1128, 1144, 1125, 1152, 1160, 1124, 1145, 1154, 1131, 1157, 1141]
  Client 0: 8843 train samples, 2 unique classes
  Client 1: 8998 train samples, 2 unique classes
  Client 2: 8728 train samples, 2 unique classes
  Client 3: 9034 train samples, 2 unique classes
  Client 4: 8866 train samples, 2 unique classes
  Client 5: 8946 train samples, 2 unique classes
  Client 6: 8873 train samples, 2 unique classes
  Client 7: 8776 train samples, 2 unique classes
  Client 8: 8816 train samples, 2 unique classes
  Client 9: 8801 train samples, 2 unique classes
  Client 10: 8913 train samples, 2 unique classes
  Client 11: 8656 train samples, 2 unique classes
  Client 12: 9115 train samples, 2 unique classes
  Client 13: 8921 train samples, 2 unique classes
  Client 14: 8699 train samples, 2 unique classes
  Client 15: 8823 train samples, 2 unique classes
  Client 16: 8912 train samples, 2 unique classes
  Client 17: 8766 train samples, 2 unique classes
  Client 18: 9102 train samples, 2 unique classes
  Client 19: 8869 train samples, 2 unique classes
Will sample 4500 samples per client per epoch
Graph: erdos, nodes: 20, edges: 99
Degree statistics: avg=9.90, min=7, max=14
Attack: Compromised 2/20 nodes: [5, 13]
Attack type: gaussian, lambda: 1.0
Model variant: baseline
Model parameters: 2,219,692
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 2,219,692 parameters
  - Rho parameter: 0.9
  - Stage 1: Distance-based filtering (select 90% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.4978 ± 0.0208
Round 001: test acc mean=0.6524 ± 0.0671 | min=0.5197 max=0.7328
         : test loss mean=0.6777 ± 0.0072
         : individual accs = ['0.703509', '0.657168', '0.626442', '0.698618', '0.548501', '0.624454', '0.702183', '0.549246', '0.718310', '0.699468', '0.680944', '0.614222', '0.710938', '0.732759', '0.678826', '0.521397', '0.715771', '0.651636', '0.694036', '0.519720']
         : correct/total = [(802, 1140), (761, 1158), (706, 1127), (809, 1158), (622, 1134), (715, 1145), (804, 1145), (619, 1127), (816, 1136), (789, 1128), (779, 1144), (691, 1125), (819, 1152), (850, 1160), (763, 1124), (597, 1145), (826, 1154), (737, 1131), (803, 1157), (593, 1141)]
         : compromised: 0.6786, honest: 0.6495
         : ubar stats = ['Node 0: s1=0.833, s2=0.400', 'Node 1: s1=0.900, s2=0.778', 'Node 2: s1=0.875, s2=0.143']...
Round 002: test acc mean=0.6765 ± 0.0667 | min=0.5273 max=0.7643
         : test loss mean=0.6499 ± 0.0388
         : individual accs = ['0.652632', '0.674439', '0.703638', '0.723661', '0.527337', '0.539738', '0.620961', '0.687666', '0.689261', '0.701241', '0.761364', '0.744000', '0.729167', '0.634483', '0.575623', '0.711790', '0.764298', '0.652520', '0.739844', '0.695881']
         : correct/total = [(744, 1140), (781, 1158), (793, 1127), (838, 1158), (598, 1134), (618, 1145), (711, 1145), (775, 1127), (783, 1136), (791, 1128), (871, 1144), (837, 1125), (840, 1152), (736, 1160), (647, 1124), (815, 1145), (882, 1154), (738, 1131), (856, 1157), (794, 1141)]
         : compromised: 0.5871, honest: 0.6864
         : ubar stats = ['Node 0: s1=0.833, s2=0.300', 'Node 1: s1=0.900, s2=0.778', 'Node 2: s1=0.875, s2=0.143']...
Round 003: test acc mean=0.7326 ± 0.0795 | min=0.5347 max=0.8349
         : test loss mean=0.5718 ± 0.0906
         : individual accs = ['0.772807', '0.702936', '0.795918', '0.765112', '0.612875', '0.605240', '0.702183', '0.679681', '0.824824', '0.764184', '0.774476', '0.795556', '0.723958', '0.706034', '0.534698', '0.824454', '0.770364', '0.798408', '0.834918', '0.664330']
         : correct/total = [(881, 1140), (814, 1158), (897, 1127), (886, 1158), (695, 1134), (693, 1145), (804, 1145), (766, 1127), (937, 1136), (862, 1128), (886, 1144), (895, 1125), (834, 1152), (819, 1160), (601, 1124), (944, 1145), (889, 1154), (903, 1131), (966, 1157), (758, 1141)]
         : compromised: 0.6556, honest: 0.7412
         : ubar stats = ['Node 0: s1=0.833, s2=0.333', 'Node 1: s1=0.900, s2=0.741', 'Node 2: s1=0.875, s2=0.143']...
Round 004: test acc mean=0.8017 ± 0.0616 | min=0.6521 max=0.8680
         : test loss mean=0.4591 ± 0.1005
         : individual accs = ['0.847368', '0.673575', '0.825200', '0.854922', '0.723986', '0.735371', '0.823581', '0.798580', '0.867958', '0.858156', '0.854021', '0.842667', '0.813368', '0.788793', '0.758897', '0.862882', '0.793761', '0.803714', '0.854797', '0.652060']
         : correct/total = [(966, 1140), (780, 1158), (930, 1127), (990, 1158), (821, 1134), (842, 1145), (943, 1145), (900, 1127), (986, 1136), (968, 1128), (977, 1144), (948, 1125), (937, 1152), (915, 1160), (853, 1124), (988, 1145), (916, 1154), (909, 1131), (989, 1157), (744, 1141)]
         : compromised: 0.7621, honest: 0.8061
         : ubar stats = ['Node 0: s1=0.833, s2=0.325', 'Node 1: s1=0.900, s2=0.750', 'Node 2: s1=0.875, s2=0.143']...
Round 005: test acc mean=0.8448 ± 0.0256 | min=0.7860 max=0.8777
         : test loss mean=0.3704 ± 0.0483
         : individual accs = ['0.835965', '0.867876', '0.832298', '0.855786', '0.832451', '0.831441', '0.877729', '0.877551', '0.852993', '0.813830', '0.876748', '0.846222', '0.840278', '0.864655', '0.862989', '0.855022', '0.785962', '0.858532', '0.839239', '0.788782']
         : correct/total = [(953, 1140), (1005, 1158), (938, 1127), (991, 1158), (944, 1134), (952, 1145), (1005, 1145), (989, 1127), (969, 1136), (918, 1128), (1003, 1144), (952, 1125), (968, 1152), (1003, 1160), (970, 1124), (979, 1145), (907, 1154), (971, 1131), (971, 1157), (900, 1141)]
         : compromised: 0.8480, honest: 0.8445
         : ubar stats = ['Node 0: s1=0.833, s2=0.440', 'Node 1: s1=0.900, s2=0.756', 'Node 2: s1=0.875, s2=0.143']...
Round 006: test acc mean=0.8748 ± 0.0101 | min=0.8541 max=0.8908
         : test loss mean=0.3079 ± 0.0201
         : individual accs = ['0.884211', '0.871330', '0.861579', '0.884283', '0.862434', '0.890830', '0.875109', '0.878438', '0.889965', '0.867908', '0.887238', '0.879111', '0.872396', '0.880172', '0.854093', '0.869869', '0.881282', '0.858532', '0.870354', '0.877301']
         : correct/total = [(1008, 1140), (1009, 1158), (971, 1127), (1024, 1158), (978, 1134), (1020, 1145), (1002, 1145), (990, 1127), (1011, 1136), (979, 1128), (1015, 1144), (989, 1125), (1005, 1152), (1021, 1160), (960, 1124), (996, 1145), (1017, 1154), (971, 1131), (1007, 1157), (1001, 1141)]
         : compromised: 0.8855, honest: 0.8736
         : ubar stats = ['Node 0: s1=0.833, s2=0.383', 'Node 1: s1=0.900, s2=0.741', 'Node 2: s1=0.875, s2=0.190']...
Round 007: test acc mean=0.8859 ± 0.0096 | min=0.8625 max=0.8946
         : test loss mean=0.2789 ± 0.0158
         : individual accs = ['0.893860', '0.893782', '0.862467', '0.894646', '0.864198', '0.894323', '0.894323', '0.890861', '0.891725', '0.890957', '0.890734', '0.891556', '0.882812', '0.880172', '0.890569', '0.870742', '0.889081', '0.882405', '0.880726', '0.888694']
         : correct/total = [(1019, 1140), (1035, 1158), (972, 1127), (1036, 1158), (980, 1134), (1024, 1145), (1024, 1145), (1004, 1127), (1013, 1136), (1005, 1128), (1019, 1144), (1003, 1125), (1017, 1152), (1021, 1160), (1001, 1124), (997, 1145), (1026, 1154), (998, 1131), (1019, 1157), (1014, 1141)]
         : compromised: 0.8872, honest: 0.8858
         : ubar stats = ['Node 0: s1=0.833, s2=0.343', 'Node 1: s1=0.900, s2=0.714', 'Node 2: s1=0.875, s2=0.184']...
Round 008: test acc mean=0.8900 ± 0.0070 | min=0.8769 max=0.9048
         : test loss mean=0.2670 ± 0.0123
         : individual accs = ['0.899123', '0.894646', '0.880213', '0.893782', '0.887125', '0.891703', '0.898690', '0.895297', '0.886444', '0.891844', '0.889860', '0.896000', '0.888021', '0.886207', '0.904804', '0.876856', '0.889948', '0.888594', '0.878133', '0.883436']
         : correct/total = [(1025, 1140), (1036, 1158), (992, 1127), (1035, 1158), (1006, 1134), (1021, 1145), (1029, 1145), (1009, 1127), (1007, 1136), (1006, 1128), (1018, 1144), (1008, 1125), (1023, 1152), (1028, 1160), (1017, 1124), (1004, 1145), (1027, 1154), (1005, 1131), (1016, 1157), (1008, 1141)]
         : compromised: 0.8890, honest: 0.8902
         : ubar stats = ['Node 0: s1=0.833, s2=0.312', 'Node 1: s1=0.900, s2=0.722', 'Node 2: s1=0.875, s2=0.196']...
Round 009: test acc mean=0.8916 ± 0.0085 | min=0.8678 max=0.9022
         : test loss mean=0.2611 ± 0.0158
         : individual accs = ['0.899123', '0.889465', '0.883762', '0.898964', '0.877425', '0.902183', '0.898690', '0.884650', '0.897887', '0.896277', '0.895105', '0.897778', '0.889757', '0.894828', '0.897687', '0.881223', '0.891681', '0.891247', '0.867761', '0.895706']
         : correct/total = [(1025, 1140), (1030, 1158), (996, 1127), (1041, 1158), (995, 1134), (1033, 1145), (1029, 1145), (997, 1127), (1020, 1136), (1011, 1128), (1024, 1144), (1010, 1125), (1025, 1152), (1038, 1160), (1009, 1124), (1009, 1145), (1029, 1154), (1008, 1131), (1004, 1157), (1022, 1141)]
         : compromised: 0.8985, honest: 0.8908
         : ubar stats = ['Node 0: s1=0.833, s2=0.289', 'Node 1: s1=0.900, s2=0.679', 'Node 2: s1=0.875, s2=0.190']...
Round 010: test acc mean=0.8986 ± 0.0072 | min=0.8825 max=0.9128
         : test loss mean=0.2502 ± 0.0147
         : individual accs = ['0.901754', '0.901554', '0.889973', '0.908463', '0.900353', '0.894323', '0.896070', '0.900621', '0.893486', '0.900709', '0.902972', '0.900444', '0.903646', '0.904310', '0.912811', '0.885590', '0.901213', '0.891247', '0.882455', '0.900088']
         : correct/total = [(1028, 1140), (1044, 1158), (1003, 1127), (1052, 1158), (1021, 1134), (1024, 1145), (1026, 1145), (1015, 1127), (1015, 1136), (1016, 1128), (1033, 1144), (1013, 1125), (1041, 1152), (1049, 1160), (1026, 1124), (1014, 1145), (1040, 1154), (1008, 1131), (1021, 1157), (1027, 1141)]
         : compromised: 0.8993, honest: 0.8985
         : ubar stats = ['Node 0: s1=0.833, s2=0.270', 'Node 1: s1=0.900, s2=0.622', 'Node 2: s1=0.875, s2=0.214']...

=== FINAL RESULTS ===
Dataset: celeba, Nodes: 20, Graph: erdos, Aggregation: ubar
Attack: gaussian, 10.0% compromised
Final accuracy - Compromised: 0.8993, Honest: 0.8985
Overall test accuracy: mean=0.8986 ± 0.0072

=== UBAR SUMMARY ===
Node 0: stage1=0.833, stage2=0.270, overall=0.225
Node 1: stage1=0.900, stage2=0.622, overall=0.560
Node 2: stage1=0.875, stage2=0.214, overall=0.188
Node 3: stage1=0.857, stage2=0.367, overall=0.314
Node 4: stage1=0.889, stage2=0.688, overall=0.611
Node 5: stage1=0.900, stage2=0.544, overall=0.490
Node 6: stage1=0.833, stage2=0.380, overall=0.317
Node 7: stage1=0.818, stage2=0.389, overall=0.318
Node 8: stage1=0.857, stage2=0.250, overall=0.214
Node 9: stage1=0.818, stage2=0.344, overall=0.282
Node 10: stage1=0.875, stage2=0.143, overall=0.125
Node 11: stage1=0.833, stage2=0.290, overall=0.242
Node 12: stage1=0.833, stage2=0.540, overall=0.450
Node 13: stage1=0.889, stage2=0.537, overall=0.478
Node 14: stage1=0.857, stage2=0.567, overall=0.486
Node 15: stage1=0.889, stage2=0.200, overall=0.178
Node 16: stage1=0.857, stage2=0.533, overall=0.457
Node 17: stage1=0.875, stage2=0.171, overall=0.150
Node 18: stage1=0.833, stage2=0.440, overall=0.367
Node 19: stage1=0.900, stage2=0.522, overall=0.470

=== PARALLEL EXECUTION TIME (realistic for distributed system) ===
  COMMUNICATION (max across nodes):
    - Full model transfer: 0.000s (0.0%)
  COMPUTATION (max across nodes):
    - Distance computation: 0.037s (14.3%)
    - Loss computation: 0.208s (79.3%)
    - Aggregation: 0.017s (6.4%)
  TOTALS:
    - Total computation: 0.263s (100.0%)
    - Total communication: 0.000s (0.0%)
    - Total parallel time: 0.263s

=== PER-NODE AVERAGE TIME ===
  - Distance computation: 0.025s
  - Loss computation: 0.163s
  - Aggregation: 0.006s
  - Model transfer: 0.000s
  - Total per node: 0.194s

=== TOTAL COMPUTATIONAL WORK (sum across all nodes) ===
  - Total distance computation: 0.507s
  - Total loss computation: 3.260s
  - Total aggregation: 0.118s
  - Total model transfer: 0.000s
  - Grand total: 3.885s
  - Mean Stage 1 acceptance rate: 0.861
  - Mean Stage 2 acceptance rate: 0.401
  - Overall acceptance rate: 0.345

UBAR Algorithm Properties:
  - Model dimension: 2,219,692
  - Rho parameter: 0.9
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 90% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation

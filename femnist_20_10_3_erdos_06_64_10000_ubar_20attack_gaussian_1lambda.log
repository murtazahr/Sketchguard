Device: cuda
Seed: 987654321
Loading 36 LEAF FEMNIST train files...
LEAF FEMNIST train: 3597 users, 734463 samples
Loading 36 LEAF FEMNIST test files...
LEAF FEMNIST test: 3597 users, 83388 samples
Found 3597 train users, 3597 test users, 3597 common users
User sample counts range: 525 (max) to 17 (min)
Distributed ALL 3597 users across 20 clients
Users per client: 179 (with 17 clients getting +1 user)
Train partition sizes: [36360, 37070, 35957, 38262, 36024, 37732, 36921, 38328, 36867, 37683, 36507, 36915, 36007, 37001, 35681, 35453, 36585, 36801, 35964, 36345]
Test partition sizes: [4128, 4203, 4081, 4333, 4091, 4287, 4193, 4349, 4191, 4277, 4143, 4193, 4093, 4197, 4052, 4029, 4153, 4183, 4084, 4128]
  Client 0: 36360 train samples, 62 unique classes
  Client 1: 37070 train samples, 62 unique classes
  Client 2: 35957 train samples, 62 unique classes
  Client 3: 38262 train samples, 62 unique classes
  Client 4: 36024 train samples, 62 unique classes
  Client 5: 37732 train samples, 62 unique classes
  Client 6: 36921 train samples, 62 unique classes
  Client 7: 38328 train samples, 62 unique classes
  Client 8: 36867 train samples, 62 unique classes
  Client 9: 37683 train samples, 62 unique classes
  Client 10: 36507 train samples, 62 unique classes
  Client 11: 36915 train samples, 62 unique classes
  Client 12: 36007 train samples, 62 unique classes
  Client 13: 37001 train samples, 62 unique classes
  Client 14: 35681 train samples, 62 unique classes
  Client 15: 35453 train samples, 62 unique classes
  Client 16: 36585 train samples, 62 unique classes
  Client 17: 36801 train samples, 62 unique classes
  Client 18: 35964 train samples, 62 unique classes
  Client 19: 36345 train samples, 62 unique classes
Will sample 10000 samples per client per epoch
Graph: erdos, nodes: 20, edges: 126
Attack: Compromised 4/20 nodes: [5, 12, 13, 17]
Attack type: gaussian, lambda: 1.0
UBAR ALGORITHM (Two-Stage Byzantine-resilient)
  - Model dimension: 6,603,710 parameters
  - Rho parameter: 0.8
  - Stage 1: Distance-based filtering (select 80% closest neighbors)
  - Stage 2: Performance-based selection (loss comparison)
  - Complexity: O(deg(i)×d + deg(i)×inference)
Initial test acc across nodes: mean=0.0162 ± 0.0138
Round 001: test acc mean=0.4289 ± 0.0513 | min=0.2713 max=0.5218
         : test loss mean=3.7359 ± 0.0701
         : individual accs = ['0.379845', '0.423269', '0.456016', '0.375490', '0.407724', '0.454630', '0.437634', '0.381927', '0.521832', '0.450082', '0.449916', '0.480801', '0.443929', '0.448416', '0.405232', '0.399355', '0.468818', '0.475496', '0.271303', '0.445979']
         : correct/total = [(1568, 4128), (1779, 4203), (1861, 4081), (1627, 4333), (1668, 4091), (1949, 4287), (1835, 4193), (1661, 4349), (2187, 4191), (1925, 4277), (1864, 4143), (2016, 4193), (1817, 4093), (1882, 4197), (1642, 4052), (1609, 4029), (1947, 4153), (1989, 4183), (1108, 4084), (1841, 4128)]
         : compromised: 0.4556, honest: 0.4222
         : ubar stats = ['Node 0: s1=0.750, s2=0.167', 'Node 1: s1=0.727, s2=0.250', 'Node 2: s1=0.750, s2=0.222']...
Round 002: test acc mean=0.6553 ± 0.0465 | min=0.5316 max=0.7238
         : test loss mean=3.1307 ± 0.3505
         : individual accs = ['0.680717', '0.706638', '0.650086', '0.605123', '0.665852', '0.610450', '0.658478', '0.680846', '0.666189', '0.689268', '0.641323', '0.716671', '0.653066', '0.531570', '0.723840', '0.672872', '0.664821', '0.609610', '0.696376', '0.582607']
         : correct/total = [(2810, 4128), (2970, 4203), (2653, 4081), (2622, 4333), (2724, 4091), (2617, 4287), (2761, 4193), (2961, 4349), (2792, 4191), (2948, 4277), (2657, 4143), (3005, 4193), (2673, 4093), (2231, 4197), (2933, 4052), (2711, 4029), (2761, 4153), (2550, 4183), (2844, 4084), (2405, 4128)]
         : compromised: 0.6012, honest: 0.6689
         : ubar stats = ['Node 0: s1=0.750, s2=0.292', 'Node 1: s1=0.727, s2=0.188', 'Node 2: s1=0.750, s2=0.167']...
Round 003: test acc mean=0.6986 ± 0.0624 | min=0.5091 max=0.7717
         : test loss mean=2.2563 ± 0.7379
         : individual accs = ['0.659641', '0.673804', '0.627542', '0.762982', '0.710095', '0.732680', '0.707846', '0.727294', '0.709377', '0.611644', '0.673184', '0.760076', '0.732714', '0.771742', '0.734205', '0.684537', '0.666025', '0.763328', '0.509060', '0.754845']
         : correct/total = [(2723, 4128), (2832, 4203), (2561, 4081), (3306, 4333), (2905, 4091), (3141, 4287), (2968, 4193), (3163, 4349), (2973, 4191), (2616, 4277), (2789, 4143), (3187, 4193), (2999, 4093), (3239, 4197), (2975, 4052), (2758, 4029), (2766, 4153), (3193, 4183), (2079, 4084), (3116, 4128)]
         : compromised: 0.7501, honest: 0.6858
         : ubar stats = ['Node 0: s1=0.750, s2=0.306', 'Node 1: s1=0.727, s2=0.167', 'Node 2: s1=0.750, s2=0.148']...
Round 004: test acc mean=0.7576 ± 0.0306 | min=0.6722 max=0.7961
         : test loss mean=1.5556 ± 0.4749
         : individual accs = ['0.737161', '0.771592', '0.764273', '0.789061', '0.746272', '0.796128', '0.748390', '0.778570', '0.776903', '0.672200', '0.779387', '0.785595', '0.745663', '0.795568', '0.741115', '0.754281', '0.694197', '0.765001', '0.759549', '0.750242']
         : correct/total = [(3043, 4128), (3243, 4203), (3119, 4081), (3419, 4333), (3053, 4091), (3413, 4287), (3138, 4193), (3386, 4349), (3256, 4191), (2875, 4277), (3229, 4143), (3294, 4193), (3052, 4093), (3339, 4197), (3003, 4052), (3039, 4029), (2883, 4153), (3200, 4183), (3102, 4084), (3097, 4128)]
         : compromised: 0.7756, honest: 0.7530
         : ubar stats = ['Node 0: s1=0.750, s2=0.312', 'Node 1: s1=0.727, s2=0.281', 'Node 2: s1=0.750, s2=0.222']...
Round 005: test acc mean=0.7840 ± 0.0163 | min=0.7537 max=0.8153
         : test loss mean=0.9864 ± 0.2755
         : individual accs = ['0.774225', '0.785391', '0.784367', '0.793215', '0.772672', '0.815255', '0.776055', '0.805473', '0.791696', '0.778583', '0.792180', '0.805628', '0.766919', '0.801048', '0.767769', '0.776868', '0.753672', '0.758307', '0.777669', '0.803052']
         : correct/total = [(3196, 4128), (3301, 4203), (3201, 4081), (3437, 4333), (3161, 4091), (3495, 4287), (3254, 4193), (3503, 4349), (3318, 4191), (3330, 4277), (3282, 4143), (3378, 4193), (3139, 4093), (3362, 4197), (3111, 4052), (3130, 4029), (3130, 4153), (3172, 4183), (3176, 4084), (3315, 4128)]
         : compromised: 0.7854, honest: 0.7837
         : ubar stats = ['Node 0: s1=0.750, s2=0.267', 'Node 1: s1=0.727, s2=0.375', 'Node 2: s1=0.750, s2=0.222']...
Round 006: test acc mean=0.8070 ± 0.0082 | min=0.7899 max=0.8220
         : test loss mean=0.7031 ± 0.0919
         : individual accs = ['0.802083', '0.806567', '0.794903', '0.807754', '0.797604', '0.803592', '0.804197', '0.817429', '0.822000', '0.806173', '0.806179', '0.815884', '0.801124', '0.822016', '0.811698', '0.800943', '0.811221', '0.789864', '0.808766', '0.810804']
         : correct/total = [(3311, 4128), (3390, 4203), (3244, 4081), (3500, 4333), (3263, 4091), (3445, 4287), (3372, 4193), (3555, 4349), (3445, 4191), (3448, 4277), (3340, 4143), (3421, 4193), (3279, 4093), (3450, 4197), (3289, 4052), (3227, 4029), (3369, 4153), (3304, 4183), (3303, 4084), (3347, 4128)]
         : compromised: 0.8041, honest: 0.8078
         : ubar stats = ['Node 0: s1=0.750, s2=0.306', 'Node 1: s1=0.727, s2=0.375', 'Node 2: s1=0.750, s2=0.204']...
Round 007: test acc mean=0.8225 ± 0.0056 | min=0.8079 max=0.8323
         : test loss mean=0.5647 ± 0.0215
         : individual accs = ['0.807897', '0.824411', '0.819407', '0.828064', '0.818137', '0.819921', '0.824708', '0.828006', '0.832260', '0.820201', '0.818006', '0.830909', '0.821891', '0.828449', '0.825271', '0.815835', '0.823742', '0.820225', '0.823213', '0.819041']
         : correct/total = [(3335, 4128), (3465, 4203), (3344, 4081), (3588, 4333), (3347, 4091), (3515, 4287), (3458, 4193), (3601, 4349), (3488, 4191), (3508, 4277), (3389, 4143), (3484, 4193), (3364, 4093), (3477, 4197), (3344, 4052), (3287, 4029), (3421, 4153), (3431, 4183), (3362, 4084), (3381, 4128)]
         : compromised: 0.8226, honest: 0.8224
         : ubar stats = ['Node 0: s1=0.750, s2=0.274', 'Node 1: s1=0.727, s2=0.339', 'Node 2: s1=0.750, s2=0.270']...
Round 008: test acc mean=0.8295 ± 0.0086 | min=0.8114 max=0.8409
         : test loss mean=0.5268 ± 0.0242
         : individual accs = ['0.819767', '0.833690', '0.822102', '0.837064', '0.822782', '0.840914', '0.840687', '0.833525', '0.836316', '0.831190', '0.823075', '0.835440', '0.828488', '0.834406', '0.838105', '0.811368', '0.825427', '0.827636', '0.836435', '0.811531']
         : correct/total = [(3384, 4128), (3504, 4203), (3355, 4081), (3627, 4333), (3366, 4091), (3605, 4287), (3525, 4193), (3625, 4349), (3505, 4191), (3555, 4277), (3410, 4143), (3503, 4193), (3391, 4093), (3502, 4197), (3396, 4052), (3269, 4029), (3428, 4153), (3462, 4183), (3416, 4084), (3350, 4128)]
         : compromised: 0.8329, honest: 0.8287
         : ubar stats = ['Node 0: s1=0.750, s2=0.292', 'Node 1: s1=0.727, s2=0.312', 'Node 2: s1=0.750, s2=0.250']...
Round 009: test acc mean=0.8383 ± 0.0057 | min=0.8289 max=0.8506
         : test loss mean=0.4980 ± 0.0187
         : individual accs = ['0.829942', '0.838687', '0.831414', '0.839603', '0.829870', '0.842081', '0.842356', '0.837894', '0.850632', '0.843816', '0.828868', '0.829955', '0.839482', '0.842745', '0.844521', '0.841896', '0.836263', '0.838154', '0.840597', '0.837209']
         : correct/total = [(3426, 4128), (3525, 4203), (3393, 4081), (3638, 4333), (3395, 4091), (3610, 4287), (3532, 4193), (3644, 4349), (3565, 4191), (3609, 4277), (3434, 4143), (3480, 4193), (3436, 4093), (3537, 4197), (3422, 4052), (3392, 4029), (3473, 4153), (3506, 4183), (3433, 4084), (3456, 4128)]
         : compromised: 0.8406, honest: 0.8377
         : ubar stats = ['Node 0: s1=0.750, s2=0.269', 'Node 1: s1=0.727, s2=0.292', 'Node 2: s1=0.750, s2=0.235']...
Round 010: test acc mean=0.8431 ± 0.0053 | min=0.8339 max=0.8513
         : test loss mean=0.4822 ± 0.0213
         : individual accs = ['0.834545', '0.851297', '0.833864', '0.849065', '0.836470', '0.840448', '0.850465', '0.839963', '0.848008', '0.848024', '0.834420', '0.842356', '0.842903', '0.841077', '0.846002', '0.845619', '0.845654', '0.842697', '0.848433', '0.840601']
         : correct/total = [(3445, 4128), (3578, 4203), (3403, 4081), (3679, 4333), (3422, 4091), (3603, 4287), (3566, 4193), (3653, 4349), (3554, 4191), (3627, 4277), (3457, 4143), (3532, 4193), (3450, 4093), (3530, 4197), (3428, 4052), (3407, 4029), (3512, 4153), (3525, 4183), (3465, 4084), (3470, 4128)]
         : compromised: 0.8418, honest: 0.8434
         : ubar stats = ['Node 0: s1=0.750, s2=0.250', 'Node 1: s1=0.727, s2=0.275', 'Node 2: s1=0.750, s2=0.222']...

=== FINAL RESULTS ===
Dataset: femnist, Nodes: 20, Graph: erdos, Aggregation: ubar
Attack: gaussian, 20.0% compromised
Final accuracy - Compromised: 0.8418, Honest: 0.8434
Overall test accuracy: mean=0.8431 ± 0.0053

=== UBAR SUMMARY ===
Node 0: stage1=0.750, stage2=0.250, overall=0.188
Node 1: stage1=0.727, stage2=0.275, overall=0.200
Node 2: stage1=0.750, stage2=0.222, overall=0.167
Node 3: stage1=0.750, stage2=0.333, overall=0.250
Node 4: stage1=0.727, stage2=0.438, overall=0.318
Node 5: stage1=0.800, stage2=0.117, overall=0.093
Node 6: stage1=0.786, stage2=0.364, overall=0.286
Node 7: stage1=0.786, stage2=0.309, overall=0.243
Node 8: stage1=0.800, stage2=0.338, overall=0.270
Node 9: stage1=0.769, stage2=0.310, overall=0.238
Node 10: stage1=0.778, stage2=0.243, overall=0.189
Node 11: stage1=0.786, stage2=0.427, overall=0.336
Node 12: stage1=0.750, stage2=0.389, overall=0.292
Node 13: stage1=0.769, stage2=0.350, overall=0.269
Node 14: stage1=0.800, stage2=0.367, overall=0.293
Node 15: stage1=0.727, stage2=0.175, overall=0.127
Node 16: stage1=0.769, stage2=0.370, overall=0.285
Node 17: stage1=0.778, stage2=0.386, overall=0.300
Node 18: stage1=0.750, stage2=0.367, overall=0.275
Node 19: stage1=0.750, stage2=0.375, overall=0.281

Performance Summary:
  - Distance computation time: 1.115s (1.3%)
  - Loss computation time: 85.292s (98.5%)
  - Aggregation time: 0.176s (0.2%)
  - Total time: 86.584s
  - Mean Stage 1 acceptance rate: 0.765
  - Mean Stage 2 acceptance rate: 0.320
  - Overall acceptance rate: 0.245

UBAR Algorithm Properties:
  - Model dimension: 6,603,710
  - Rho parameter: 0.8
  - Two-stage approach: Distance filtering + loss evaluation
  - Stage 1 selects: 80% of neighbors
  - Stage 2 uses: Training sample loss comparison
  - Theoretical complexity: O(deg(i)×d + deg(i)×inference)
  - Approach: UBAR paper implementation
